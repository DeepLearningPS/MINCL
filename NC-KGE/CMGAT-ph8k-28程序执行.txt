kill -9 $(ps aux | grep run_pharm8k-28_no_dgi.py | grep -v grep | awk '{print $2}')

RHCGAT模型的特点是：模型的时空复杂度和节点数量呈现增正相关，而与三元组的数量关系不大。


优化器：从tmux test100开始

 CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29600 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adam --use_test 1 --test_name optimizer_adam #默认adam,不使用残差,使用偏置，2层网络，打分函数conve。这是基线


 CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29601 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adamw --use_test 1 --test_name optimizer_adamw
结束，需要手动执行测试数据集.测试结束


目前得出的结论是：

1、关于adamw，在'ReduceLROnPlateau'动态学习率与静态学习率策略方面：静态效果好

2、在'ReduceLROnPlateau'动态学习率方面：adam（默认是不使用自身的权重衰减）比adamw效果好

前两个得出：静态的adam效果好

3、关于adamw，在所有动态学习率的策略中，'CosineAnnealingLR'动态学习率策略最好（也是目前所有实验效果最好的）。使用这个

4、在评分函数方面，性能由好到坏：conve、distmult、transe

5、使用偏置效果更好

6、不使用残差效果好

再测试：
CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29602 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adam --lr_scheduler CosineAnnealingLR --use_test 1 --test_name new_optimizer_adam_CosineAnnealingLR


结果：adam和adamW在CosineAnnealingLR上，性能不分上下。

学习率策略，动态变化。
['CyclicLR', 'OneCycleLR', 'CosineAnnealingWarmRestarts', 'ReduceLROnPlateau', 'CosineAnnealingLR']

ReduceLROnPlateau', 'CosineAnnealingLR'效果最好，其它的有些参数需要研究，不好设置，需要进一步研究。最差的是'CyclicLR', 'OneCycleLR', 'CosineAnnealingWarmRestarts'（较好）。

性能又好到坏排名： 'CosineAnnealingLR', 'ReduceLROnPlateau', 'CosineAnnealingWarmRestarts', 'OneCycleLR', 'CyclicLR',

其中'CosineAnnealingLR'， 'ReduceLROnPlateau'的自动更新学习率性能优于固定学习率的。CosineAnnealingLR学习率变化激烈，而ReduceLROnPlateau前期变化少,甚至不变化，后期变化多

优化器选择：['adamw', 'adam', 'sgd', 'adagrad']

性能由高到低：'adam', 'adam'， 'adagrad'， 'sgd'，前两个性能差距不大，后2个效果很差。值得注意的是，adamw与adam的唯一区别是，adamw是有默认权重衰减,0.01，而adam是有默认权重衰减为0， 其它都一样。
注意优化器 ，即使使用权重衰减，如果不使用学习率动态调整策略，学习率也不会改变。即使adam的默认权重衰减为0，但是如如果使用学习率动态调整策略，则学习率依旧会改变


CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29602 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adamw --lr_scheduler CosineAnnealingLR --use_test 1 --test_name new_optimizer_adamw_CosineAnnealingLR --epoch 100
结束 ，需要手动执行测试数据集，测试结束

CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29603 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adamw --lr_scheduler CosineAnnealingWarmRestarts --use_test 1 --test_name new_optimizer_adamw_T_mult2_CosineAnnealingWarmRestarts --epoch 100


CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29604 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adamw --lr_scheduler ReduceLROnPlateau --use_test 1 --test_name new_optimizer_adamw_ReduceLROnPlateau --epoch 100
结束 ，需要手动执行测试数据集，测试结束

CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29605 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adamw --lr_scheduler CyclicLR --use_test 1 --test_name new_optimizer_adamw_CyclicLR --epoch 100


CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29606 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adamw --lr_scheduler OneCycleLR --use_test 1 --test_name new_optimizer_adamw_OneCycleLR --epoch 100



CUDA_VISIBLE_DEVICES=0 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29607 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer sgd --lr_scheduler ReduceLROnPlateau --use_test 1 --test_name new_optimizer_sgd_ReduceLROnPlateau --epoch 100  #性能很差，不使用


CUDA_VISIBLE_DEVICES=1 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29608 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adagrad --lr_scheduler ReduceLROnPlateau --use_test 1 --test_name new_optimizer_adagrad_ReduceLROnPlateau --epoch 100，以后在测试


CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29609 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adam --lr_scheduler ReduceLROnPlateau --use_test 1 --test_name new_optimizer_adam_ReduceLROnPlateau --epoch 100  效果最好
跑




 残差：

CUDA_VISIBLE_DEVICES=0 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29610 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adam --lr_scheduler ReduceLROnPlateau --add_skip_connection True --use_test 1 --test_name B_add_skip_connection_adam_ReduceLROnPlateau #默认不使用残差， 默认是2层网络，这里的测试和网络层的一个重复。好像不加残差效果更好。（毕竟不像CNN，有几十层网络）
跑

 偏置：


CUDA_VISIBLE_DEVICES=1 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29611 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adam --lr_scheduler ReduceLROnPlateau --bias_gat False --bias False --use_test 1 --test_name B_No_add_bias_adam_ReduceLROnPlateau #默认使用偏置

跑

 网络层：

CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29612 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adam --lr_scheduler ReduceLROnPlateau --num_of_layers 1 --num_heads_per_layer 8 --num_features_per_layer 200 --num_features_per_layer 25 --use_test 1 --test_name B_layers1_adam_ReduceLROnPlateau #无残差的一层网络，默认是2层无残差网络
由于涉及问题，一层网络没设计，所以暂时无法执行

打分函数： 默认使用的是conve

CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29613 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adam --lr_scheduler ReduceLROnPlateau --score_func transe --use_test 1 --test_name B_transe_adam_ReduceLROnPlateau
跑


CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29614 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adam --lr_scheduler ReduceLROnPlateau --score_func distmult --use_test 1 --test_name B_distmult_adam_ReduceLROnPlateau 
 跑



 部分实验结果测试：

 CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29601 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adamw --use_test 1 --test_name test_optimizer_adamw --test 1 --save_path LP_optimizer_adamw_notext_PharmKG8k-28_CLrhcgat_07_05_2022_10_25_29
测试结束


CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29604 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adamw --lr_scheduler ReduceLROnPlateau --use_test 1 --test_name test_new_optimizer_adamw_ReduceLROnPlateau --test 1 --save_path LP_new_optimizer_adamw_ReduceLROnPlateau_notext_PharmKG8k-28_CLrhcgat_07_05_2022_20_44_52
测试结束



CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29602 run_pharm8k-28_no_dgi.py --dataset PharmKG8k-28 --optimizer adamw --lr_scheduler CosineAnnealingLR --use_test 1 --test_name test_new_optimizer_adamw_CosineAnnealingLR --test 1 --save_path LP_new_optimizer_adamw_CosineAnnealingLR_notext_PharmKG8k-28_CLrhcgat_07_05_2022_20_44_44 
测试结束



生成节点类型和属性信息，现在不确定实体和id，以及与类型的对应关系，所以先使用默认的值，看看效果。

先找实体名对应的实体id(依旧是字符串，entity_id或者relation_id)






新实验：tmux 从601开始

CUDA_VISIBLE_DEVICES=3 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29601 run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --optimizer adam --change_lr 0 

跑
先在丹阳的模型上跑，之后需要在其基础上，把网络换成Transformer


基础模型的效果：

2022-06-22 03:18:19,008 - [INFO] - Early Stopping!!
2022-06-22 03:18:19,008 - [INFO] - best_epoch: 546
2022-06-22 03:18:19,008 - [INFO] - best_lr: 0.0010000000
2022-06-22 03:18:19,008 - [INFO] - best_mrr: 0.21251
2022-06-22 03:18:19,009 - [INFO] - best_mr: 191.67406
2022-06-22 03:18:19,009 - [INFO] - best_hit1: 0.12836
2022-06-22 03:18:19,009 - [INFO] - best_hit3: 0.23634
2022-06-22 03:18:19,009 - [INFO] - best_hit10: 0.37542
2022-06-22 03:18:19,009 - [INFO] -

2022-06-22 03:18:50,756 - [INFO] - 测试:
2022-06-22 03:18:50,756 - [INFO] - Test_mrr: 0.21266
2022-06-22 03:18:50,756 - [INFO] - Test_mr: 192.98913
2022-06-22 03:18:50,756 - [INFO] - Test_hit1: 0.12843
2022-06-22 03:18:50,756 - [INFO] - Test_hit3: 0.23690
2022-06-22 03:18:50,757 - [INFO] - Test_hit10: 0.37565


CMAGAT比ComGCN效果好。




tmux cmgat1
CUDA_VISIBLE_DEVICES=1 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 效果不好了，从新试一下
效果依旧不好
数据集没啥问题，可能CMGAT生成的子图的随机性是不同的，导致生成的东西不一样，而该东西对模型影响很大，所以，我们换成老数据试一下

继续跑

CUDA_VISIBLE_DEVICES=1 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --optimizer adam --change_lr 0 


还是有问题：我们使用备份的代码，然后使用通用数据
tmux cmgat2
CUDA_VISIBLE_DEVICES=1 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --optimizer adam --change_lr 0 

使用老数据集：

tmux test2
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --optimizer adam --change_lr 0 

这个效果好了；难道数据有差别？数据集没啥问题，可能CMGAT生成的子图的随机性是不同的，导致生成的东西不一样，而该东西对模型影响很大，所以，我们换成老数据试一下
为什么CompGCN不受影响？因为其用不到额外信息。可以在数据生成的过程中，加上随机种子

找到原因了，是因为更改了adam的配置，导致不如默认的adam,现在改回来


tmux cmgat2 epoch = 1000, 去掉标签平滑，正常跑
CUDA_VISIBLE_DEVICES=1 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function bcel_loss 


下面的打分函数的值都经过sigmoid处理后再送入CL里面的，这样未必是正确
tmux cmgat1 使用对比学习
CUDA_VISIBLE_DEVICES=1 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name contrastive_loss --score_func simple --subgraph_loss_rate 0

有问题，损失下降太快。

去掉子图级别的损失看看，不行

CUDA_VISIBLE_DEVICES=1 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name contrastive_loss --score_func simple --subgraph_loss_rate 0


tmux cmgat2 正常跑 bcel_loss, conve ，结束，以此为参考
CUDA_VISIBLE_DEVICES=1 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --optimizer adam --change_lr 0

2023-04-07 10:49:17,831 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 962
2023-04-07 10:49:17,831 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-07 10:49:17,831 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.22567
2023-04-07 10:49:17,831 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 185.61968
2023-04-07 10:49:17,831 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.14391
2023-04-07 10:49:17,831 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.24790
2023-04-07 10:49:17,831 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.38381
2023-04-07 10:49:17,831 - run_pharm8k-28_no_dgi.py - [INFO] -

2023-04-07 10:49:38,285 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-04-07 10:49:38,285 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.22478
2023-04-07 10:49:38,286 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 185.83284
2023-04-07 10:49:38,286 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.14294
2023-04-07 10:49:38,286 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.24765
2023-04-07 10:49:38,286 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.38392

file_name: CMGAT/workdir/06_04_2023_16_12_31


CLoss出现了nan，意味着存在inf， 解决办法：打分缩放










softmax_mask损失：

tmux a -t cmgat1 这个有效果 mask_softmax， simple， 比使用conve打分差了不少
CUDA_VISIBLE_DEVICES=1 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function mask_softmax --use_test 1 --test_name masksoftmax_loss --score_func simple --subgraph_loss_rate 0

2023-04-09 13:23:48,834 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 964
2023-04-09 13:23:48,834 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-09 13:23:48,834 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.20005
2023-04-09 13:23:48,834 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 211.37965
2023-04-09 13:23:48,834 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.12188
2023-04-09 13:23:48,834 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.21808
2023-04-09 13:23:48,834 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.35304
2023-04-09 13:23:48,834 - run_pharm8k-28_no_dgi.py - [INFO] -

2023-04-09 13:24:06,249 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-04-09 13:24:06,249 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.19853
2023-04-09 13:24:06,249 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 213.96217
2023-04-09 13:24:06,249 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.12131
2023-04-09 13:24:06,249 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.21501
2023-04-09 13:24:06,250 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.35196

file name: workdir/masksoftmax_loss_06_04_2023_17_05_17/06_04_2023_17_05_17_stdout.log









tmux a -t cmgat3  conve mask_softmax conve，效果和基线相当，不分上下
CUDA_VISIBLE_DEVICES=1 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function mask_softmax --use_test 1 --test_name masksoftmax_loss --score_func conve --subgraph_loss_rate 0

2023-04-09 15:18:26,088 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 811
2023-04-09 15:18:26,088 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-09 15:18:26,088 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.20808
2023-04-09 15:18:26,088 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 185.59430
2023-04-09 15:18:26,088 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.12589
2023-04-09 15:18:26,088 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.22908
2023-04-09 15:18:26,088 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.36943
2023-04-09 15:18:26,088 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-09 15:18:26,088 - run_pharm8k-28_no_dgi.py - [INFO] - Loading best model, Evaluating on Test data
2023-04-09 15:18:39,231 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-09 15:18:39,231 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-04-09 15:18:39,231 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.20851
2023-04-09 15:18:39,232 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 186.36407
2023-04-09 15:18:39,232 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.12621
2023-04-09 15:18:39,232 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.22990
2023-04-09 15:18:39,232 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.36823

file name: workdir/masksoftmax_loss_06_04_2023_20_21_32/06_04_2023_20_21_32_stdout.log

再跑 MLoss进过softmax之后缩放 tmux a -t cmgat1
CUDA_VISIBLE_DEVICES=2 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function mask_softmax --use_test 1 --test_name MLoss --score_func conve --subgraph_loss_rate 0

2023-04-14 15:14:58,083 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 509
2023-04-14 15:14:58,083 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-14 15:14:58,083 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.20750
2023-04-14 15:14:58,083 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 192.46671
2023-04-14 15:14:58,083 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.12576
2023-04-14 15:14:58,083 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.22799
2023-04-14 15:14:58,083 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.36854
2023-04-14 15:14:58,083 - run_pharm8k-28_no_dgi.py - [INFO]



再跑 MLoss进过softmax之后不缩放 tmux  a -t cmgat3
CUDA_VISIBLE_DEVICES=2 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function mask_softmax --use_test 1 --test_name MLoss2 --score_func conve --subgraph_loss_rate 0

2023-04-14 15:19:33,037 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 489
2023-04-14 15:19:33,037 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-14 15:19:33,037 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.20475
2023-04-14 15:19:33,037 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 185.22308
2023-04-14 15:19:33,037 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.12206
2023-04-14 15:19:33,037 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.22563
2023-04-14 15:19:33,037 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.36630
2023-04-14 15:19:33,037 - run_pharm8k-28_no_dgi.py - [INFO] -


softmax之后是否缩放不影响模型






对每一条数据的正样本得分求均值：tmux  a -t cmgat4，求均值效果不好

CUDA_VISIBLE_DEVICES=2 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function mask_softmax --use_test 1 --test_name MLoss-mean --score_func conve --subgraph_loss_rate 0

2023-04-14 15:08:12,583 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 99
2023-04-14 15:08:12,583 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-14 15:08:12,583 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.14045
2023-04-14 15:08:12,583 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 282.44138
2023-04-14 15:08:12,583 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.07831
2023-04-14 15:08:12,583 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.14769
2023-04-14 15:08:12,583 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.26040
2023-04-14 15:08:12,584 - run_pharm8k-28_no_dgi.py - [INFO] - 


测试一下以求和的方式处理总的损失，即原来的均值变成求和。结论：两者差异不大，还是采用均值吧

tmux a -t cmgat1 跑

CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function mask_softmax --use_test 1 --test_name MLoss-all-sum --score_func conve --subgraph_loss_rate 0

2023-04-17 17:34:05,092 - run_pharm8k-28_no_dgi.py - [INFO] - Early Stopping!!
2023-04-17 17:34:05,092 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 249
2023-04-17 17:34:05,092 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-17 17:34:05,092 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.19858
2023-04-17 17:34:05,092 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 187.81901
2023-04-17 17:34:05,092 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.11711
2023-04-17 17:34:05,092 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.21843
2023-04-17 17:34:05,092 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.35754
2023-04-17 17:34:05,092 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-17 17:34:44,323 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-04-17 17:34:44,324 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.19949
2023-04-17 17:34:44,324 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 188.11854
2023-04-17 17:34:44,324 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.11754
2023-04-17 17:34:44,324 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.22130
2023-04-17 17:34:44,324 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.35839




结论：

softmax损失结论：softmax之后是否缩放不影响效果，另外求和远远好于求均值，此外其效果不如BCELoss损失，打分函数conve效果比simple效果好点








对比学习损失 + 部分采样：


tmux a -t cmgat2  conve, 部分采样，对比学习有效果了，原因是提前除温度系数，然后再加减乘除，效果仅相当于mask_softmax simple, 出现了nan。依旧出现了nan, 结束。跑，对比损失不缩放
CUDA_VISIBLE_DEVICES=2 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample --score_func conve --subgraph_loss_rate 0 --sample_mod part

确实比全采样效果好，但依旧不如其它损失

出现了nan
2023-04-13 08:05:07,932 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 55
2023-04-13 08:05:07,932 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-13 08:05:07,932 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.10617
2023-04-13 08:05:07,932 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 311.99633
2023-04-13 08:05:07,932 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.05089
2023-04-13 08:05:07,932 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.10918
2023-04-13 08:05:07,932 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.21061
2023-04-13 08:05:07,932 - run_pharm8k-28_no_dgi.py - [INFO] -


tmux a -t cmgat2
CUDA_VISIBLE_DEVICES=0 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5


2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 185
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.13273
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 260.97801
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.06536
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.14231
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.26354
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] -


试一下更小的温度系数： tmux4
CUDA_VISIBLE_DEVICES=0 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem0.01  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.01

2023-04-13 09:47:20,127 - run_pharm8k-28_no_dgi.py - [INFO] - Number of parameters: 8609403
2023-04-13 09:54:27,354 - run_pharm8k-28_no_dgi.py - [INFO] - 验证:
2023-04-13 09:54:27,355 - run_pharm8k-28_no_dgi.py - [INFO] - Epoch:1  time 7.0m  LR:0.0010000000
2023-04-13 09:54:27,355 - run_pharm8k-28_no_dgi.py - [INFO] - Train Loss:nan  Valid Loss:nan
2023-04-13 09:54:27,355 - run_pharm8k-28_no_dgi.py - [INFO] - Valid MRR:0.00404  Valid MR:1958.59166
2023-04-13 09:54:27,356 - run_pharm8k-28_no_dgi.py - [INFO] - Valid H@1:0.00025  Valid H@3:0.00120  Valid H@10:0.00768
2023-04-13 09:54:27,356 - run_pharm8k-28_no_dgi.py - [INFO] -


试一下更大的温度系数： tmux4 
CUDA_VISIBLE_DEVICES=0 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem100  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 100



2023-04-14 10:04:30,925 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 220
2023-04-14 10:04:30,925 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-14 10:04:30,925 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.10769
2023-04-14 10:04:30,926 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 318.69960
2023-04-14 10:04:30,926 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.05251
2023-04-14 10:04:30,926 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.10986
2023-04-14 10:04:30,926 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.21289
2023-04-14 10:04:30,926 - run_pharm8k-28_no_dgi.py - [INFO] -




softmax处理试试 tmux2，不行

CUDA_VISIBLE_DEVICES=0 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem0.5-softmax  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5




tmux 2 样本数量

CUDA_VISIBLE_DEVICES=0 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem0.5-neg200-pos1 --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --pos_sample_num 1 --neg_sample_num 200

样本数量的改变不会导致模型性能有大幅度改变，所以这个因素先不考虑


常规模型会在100epoch是得到不错的结果，可以以此为参照即使停止模型。为了方便调试，我们设置 stop_num == 50
2022-06-21 13:00:17,552 - LP_notext_New_PharmKG8k-28_CLrhcgat_21_06_2022_10_50_05.log - [INFO] - best_epoch: 100
2022-06-21 13:00:17,552 - LP_notext_New_PharmKG8k-28_CLrhcgat_21_06_2022_10_50_05.log - [INFO] - best_lr: 0.0010000000
2022-06-21 13:00:17,552 - LP_notext_New_PharmKG8k-28_CLrhcgat_21_06_2022_10_50_05.log - [INFO] - best_mrr: 0.17735
2022-06-21 13:00:17,552 - LP_notext_New_PharmKG8k-28_CLrhcgat_21_06_2022_10_50_05.log - [INFO] - best_mr: 210.24738
2022-06-21 13:00:17,553 - LP_notext_New_PharmKG8k-28_CLrhcgat_21_06_2022_10_50_05.log - [INFO] - best_hit1: 0.09920
2022-06-21 13:00:17,553 - LP_notext_New_PharmKG8k-28_CLrhcgat_21_06_2022_10_50_05.log - [INFO] - best_hit3: 0.19523
2022-06-21 13:00:17,553 - LP_notext_New_PharmKG8k-28_CLrhcgat_21_06_2022_10_50_05.log - [INFO] - best_hit10: 0.33053
2022-06-21 13:00:17,553 - LP_notext_New_PharmKG8k-28_CLrhcgat_21_06_2022_10_50_05.log - [INFO] 



tmux3 对总的损失求和而不是均值 跑

CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem0.5-neg20-pos1-loss-sum --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --pos_sample_num 1 --neg_sample_num 20 


2023-04-18 05:51:54,038 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 90
2023-04-18 05:51:54,038 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-18 05:51:54,038 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.10235
2023-04-18 05:51:54,038 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 289.64346
2023-04-18 05:51:54,038 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.04839
2023-04-18 05:51:54,038 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.10285
2023-04-18 05:51:54,038 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.20603
2023-04-18 05:51:54,038 - run_pharm8k-28_no_dgi.py - [INFO] -


出现了nan


tmux2 负样本 == 20 跑

CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem0.5-neg20-pos1 --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --pos_sample_num 1 --neg_sample_num 20 

出现nan

2023-04-17 11:08:00,805 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 49
2023-04-17 11:08:00,805 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-17 11:08:00,805 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.09127
2023-04-17 11:08:00,805 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 322.40996
2023-04-17 11:08:00,805 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.04265
2023-04-17 11:08:00,805 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.08995
2023-04-17 11:08:00,805 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.18273
2023-04-17 11:08:00,805 - run_pharm8k-28_no_dgi.py - [INFO] -




tmux a -t cmgat2 损失按求和来,采样100
CUDA_VISIBLE_DEVICES=0 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5



2023-04-18 09:20:10,150 - run_pharm8k-28_no_dgi.py - [INFO] - Early Stopping!!
2023-04-18 09:20:10,150 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 72
2023-04-18 09:20:10,150 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-18 09:20:10,150 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.11245
2023-04-18 09:20:10,150 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 289.64358
2023-04-18 09:20:10,151 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.05342
2023-04-18 09:20:10,151 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.11621
2023-04-18 09:20:10,151 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.22610
2023-04-18 09:20:10,151 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-18 09:20:21,477 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-04-18 09:20:21,477 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.11264
2023-04-18 09:20:21,478 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 291.08604
2023-04-18 09:20:21,478 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.05409
2023-04-18 09:20:21,478 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.11660
2023-04-18 09:20:21,478 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.22560

出现了nan 




tmux a -t cmgat2 损失按均值来,采样100
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5



2023-04-18 15:11:12,882 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 83
2023-04-18 15:11:12,882 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-18 15:11:12,882 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.11626
2023-04-18 15:11:12,882 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 290.15287
2023-04-18 15:11:12,882 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.05661
2023-04-18 15:11:12,882 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.12075
2023-04-18 15:11:12,882 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.23124
2023-04-18 15:11:12,882 - run_pharm8k-28_no_dgi.py - [INFO] -


出现了nan,无法再现之前的效果




tmux a -t cmgat2
CUDA_VISIBLE_DEVICES=0 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5


2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 185
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.13273
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 260.97801
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.06536
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.14231
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.26354
2023-04-14 10:09:29,542 - run_pharm8k-28_no_dgi.py - [INFO] -


对比这个再跑，--stop_num 200

CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 200


2023-04-18 23:00:03,195 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 48
2023-04-18 23:00:03,195 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-18 23:00:03,195 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.10491
2023-04-18 23:00:03,195 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 320.42020
2023-04-18 23:00:03,195 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.05032
2023-04-18 23:00:03,195 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.10722
2023-04-18 23:00:03,195 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.20900
2023-04-18 23:00:03,195 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-18 23:03:33,134 - run_pharm8k-28_no_dgi.py - [INFO] - 验证:
2023-04-18 23:03:33,134 - run_pharm8k-28_no_dgi.py - [INFO] - Epoch:131  time 3.0m  LR:0.0010000000
2023-04-18 23:03:33,134 - run_pharm8k-28_no_dgi.py - [INFO] - Train Loss:nan  Valid Loss:nan
2023-04-18 23:03:33,134 - run_pharm8k-28_no_dgi.py - [INFO] - Valid MRR:0.00404  Valid MR:1958.59166
2023-04-18 23:03:33,134 - run_pharm8k-28_no_dgi.py - [INFO] - Valid H@1:0.00025  Valid H@3:0.00120  Valid H@10:0.00768
2023-04-18 23:03:33,134 - run_pharm8k-28_no_dgi.py - [INFO] -


tmux a -t cmgat2 tem = 1.0
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem1.0  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 1.0 --stop_num 200

出现nan的情况断断续续






2023-04-19 16:07:16,498 - run_pharm8k-28_no_dgi.py - [INFO] - 验证:
2023-04-19 16:07:16,498 - run_pharm8k-28_no_dgi.py - [INFO] - Epoch:255  time 6.0m  LR:0.0010000000
2023-04-19 16:07:16,499 - run_pharm8k-28_no_dgi.py - [INFO] - Train Loss:nan  Valid Loss:nan
2023-04-19 16:07:16,499 - run_pharm8k-28_no_dgi.py - [INFO] - Valid MRR:0.00404  Valid MR:1958.59166
2023-04-19 16:07:16,499 - run_pharm8k-28_no_dgi.py - [INFO] - Valid H@1:0.00025  Valid H@3:0.00120  Valid H@10:0.00768
2023-04-19 16:07:16,499 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-19 16:07:16,499 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 155
2023-04-19 16:07:16,499 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-19 16:07:16,499 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.12943
2023-04-19 16:07:16,499 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 268.94731
2023-04-19 16:07:16,499 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.06345
2023-04-19 16:07:16,499 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.13819
2023-04-19 16:07:16,499 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.25789
2023-04-19 16:07:16,499 - run_pharm8k-28_no_dgi.py - [INFO] -








tmux a -t cmgat1 tem = 2.0
CUDA_VISIBLE_DEVICES=2 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem2.0  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 2.0 --stop_num 100

2023-04-19 10:22:29,675 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 78
2023-04-19 10:22:29,675 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-19 10:22:29,675 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.11347
2023-04-19 10:22:29,675 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 290.12140
2023-04-19 10:22:29,675 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.05455
2023-04-19 10:22:29,676 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.11776
2023-04-19 10:22:29,676 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.22667
2023-04-19 10:22:29,676 - run_pharm8k-28_no_dgi.py - [INFO] -

2023-04-19 16:16:20,883 - run_pharm8k-28_no_dgi.py - [INFO] - Early Stopping!!
2023-04-19 16:16:20,883 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 78
2023-04-19 16:16:20,883 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-19 16:16:20,883 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.11347
2023-04-19 16:16:20,883 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 290.12140
2023-04-19 16:16:20,883 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.05455
2023-04-19 16:16:20,883 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.11776
2023-04-19 16:16:20,883 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.22667
2023-04-19 16:16:20,883 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-19 16:16:34,280 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-04-19 16:16:34,281 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.11295
2023-04-19 16:16:34,281 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 293.12517
2023-04-19 16:16:34,281 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.05415
2023-04-19 16:16:34,281 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.11733
2023-04-19 16:16:34,281 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.22590










看看是不是打分函数导致的nan

tmux a -t cmgat3 tem = 1.0
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem1.0  --score_func complex --subgraph_loss_rate 0 --sample_mod part --temperature 1.0 --stop_num 100

2023-04-19 12:09:17,260 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 1
2023-04-19 12:09:17,260 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-19 12:09:17,260 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.00404
2023-04-19 12:09:17,261 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 1958.59166
2023-04-19 12:09:17,261 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.00025
2023-04-19 12:09:17,261 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.00120
2023-04-19 12:09:17,261 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.00768
2023-04-19 12:09:17,261 - run_pharm8k-28_no_dgi.py - [INFO] -

直接nan


tmux a -t cmgat3 tem = 10.0
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem10.0  --score_func complex --subgraph_loss_rate 0 --sample_mod part --temperature 10.0 --stop_num 100


2023-04-19 14:24:31,371 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 1
2023-04-19 14:24:31,372 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-19 14:24:31,372 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.00404
2023-04-19 14:24:31,372 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 1958.59166
2023-04-19 14:24:31,372 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.00025
2023-04-19 14:24:31,372 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.00120
2023-04-19 14:24:31,372 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.00768
2023-04-19 14:24:31,372 - run_pharm8k-28_no_dgi.py - [INFO] -



tmux a -t cmgat3 tem = 1.0 transe
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem1.0  --score_func transe --subgraph_loss_rate 0 --sample_mod part --temperature 1.0 --stop_num 200

2023-04-19 14:51:31,362 - run_pharm8k-28_no_dgi.py - [INFO] - 验证:
2023-04-19 14:51:31,362 - run_pharm8k-28_no_dgi.py - [INFO] - Epoch:2  time 6.0m  LR:0.0010000000
2023-04-19 14:51:31,362 - run_pharm8k-28_no_dgi.py - [INFO] - Train Loss:nan  Valid Loss:nan
2023-04-19 14:51:31,362 - run_pharm8k-28_no_dgi.py - [INFO] - Valid MRR:0.00404  Valid MR:1958.59166
2023-04-19 14:51:31,362 - run_pharm8k-28_no_dgi.py - [INFO] - Valid H@1:0.00025  Valid H@3:0.00120  Valid H@10:0.00768
2023-04-19 14:51:31,362 - run_pharm8k-28_no_dgi.py - [INFO] -


tmux a -t cmgat4 tem = 1.0 simple
CUDA_VISIBLE_DEVICES=2 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-part-sample-Tem1.0  --score_func simple --subgraph_loss_rate 0 --sample_mod part --temperature 1.0 --stop_num 100


2023-04-19 16:29:43,455 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 8
2023-04-19 16:29:43,455 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-19 16:29:43,455 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.06685
2023-04-19 16:29:43,455 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 509.89350
2023-04-19 16:29:43,455 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.03095
2023-04-19 16:29:43,456 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.06317
2023-04-19 16:29:43,456 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.13047
2023-04-19 16:29:43,456 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-19 16:33:02,613 - run_pharm8k-28_no_dgi.py - [INFO] - 验证:
2023-04-19 16:33:02,613 - run_pharm8k-28_no_dgi.py - [INFO] - Epoch:21  time 3.0m  LR:0.0010000000
2023-04-19 16:33:02,613 - run_pharm8k-28_no_dgi.py - [INFO] - Train Loss:nan  Valid Loss:nan
2023-04-19 16:33:02,613 - run_pharm8k-28_no_dgi.py - [INFO] - Valid MRR:0.00404  Valid MR:1958.59166
2023-04-19 16:33:02,613 - run_pharm8k-28_no_dgi.py - [INFO] - Valid H@1:0.00025  Valid H@3:0.00120  Valid H@10:0.00768
2023-04-19 16:33:02,613 - run_pharm8k-28_no_dgi.py - [INFO] -














现在基本上可以确定的是从打分函数获取的得分中的某些元素值过大，导致exp(x)溢出，出现inf. torch.exp(x > 85)时出现inf
如何解决呢？缩放或去掉torch.exp()


在求pred = torch.exp(pred / self.p.temperature，就出现了nan



不要torch.exp() tmux a -t cmgat1 tem = 0.5，不要不行


现在的方法：向量单位化或者每一行除以当前行的最大值

CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name UnitVec-CLoss-part-sample-Tem0.5  --score_func simple --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 100

2023-04-21 08:53:34,758 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 265
2023-04-21 08:53:34,758 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-21 08:53:34,758 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.06937
2023-04-21 08:53:34,758 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 793.36831
2023-04-21 08:53:34,758 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.03183
2023-04-21 08:53:34,758 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.06717
2023-04-21 08:53:34,758 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.13623
2023-04-21 08:53:34,758 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-21 08:56:53,159 - run_pharm8k-28_no_dgi.py - [INFO] - 验证:
2023-04-21 08:56:53,159 - run_pharm8k-28_no_dgi.py - [INFO] - Epoch:366  time 3.0m  LR:0.0010000000
2023-04-21 08:56:53,159 - run_pharm8k-28_no_dgi.py - [INFO] - Train Loss:4.3718995294  Valid Loss:4.5047233246
2023-04-21 08:56:53,159 - run_pharm8k-28_no_dgi.py - [INFO] - Valid MRR:0.06889  Valid MR:811.22615
2023-04-21 08:56:53,159 - run_pharm8k-28_no_dgi.py - [INFO] - Valid H@1:0.03112  Valid H@3:0.06697  Valid H@10:0.13756





cmagt2
CUDA_VISIBLE_DEVICES=2 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name UnitVec-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 100




2023-04-21 10:10:05,176 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 302
2023-04-21 10:10:05,176 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-21 10:10:05,176 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.07306
2023-04-21 10:10:05,176 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 634.71215
2023-04-21 10:10:05,176 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.03599
2023-04-21 10:10:05,176 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.07053
2023-04-21 10:10:05,177 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.13973
2023-04-21 10:10:05,177 - run_pharm8k-28_no_dgi.py - [INFO] -


还在跑，未出现inf，但是效果不好


#除以每一行的最大值 cmgat3 不行
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name MaxLine-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 100









#加一个BN层试试 cmgat3

CUDA_VISIBLE_DEVICES=1 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name BN-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 100




2023-04-21 06:19:55,487 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 257
2023-04-21 06:19:55,487 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-21 06:19:55,487 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.14690
2023-04-21 06:19:55,487 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 255.50454
2023-04-21 06:19:55,487 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.07215
2023-04-21 06:19:55,487 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.16048
2023-04-21 06:19:55,487 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.29321
2023-04-21 06:19:55,487 - run_pharm8k-28_no_dgi.py - [INFO] -


pred = torch.exp(pred / self.p.temperature) 出现了inf

解决方法：先单位化，再BN；先BN，再单位化


tmux a -t cmgat1 缩放，先单位化，再BN，静态学习率
CUDA_VISIBLE_DEVICES=1 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name UnitVec-BN-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 100


2023-04-24 02:36:12,387 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 943
2023-04-24 02:36:12,387 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-24 02:36:12,387 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.17803
2023-04-24 02:36:12,388 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 230.59675
2023-04-24 02:36:12,388 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.09610
2023-04-24 02:36:12,388 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.19932
2023-04-24 02:36:12,388 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.33764
2023-04-24 02:36:12,388 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-24 02:36:27,054 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-04-24 02:36:27,055 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.17735
2023-04-24 02:36:27,055 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 230.19205
2023-04-24 02:36:27,055 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.09503
2023-04-24 02:36:27,055 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.19892
2023-04-24 02:36:27,055 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.33706



tmux a -t cmgat2 先BN，再单位化，该方法不行
CUDA_VISIBLE_DEVICES=2 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name BN-UnitVec-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 100




tmux a -t cmgat3 不单位化，而是缩放，最后BN,结束
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name Scale-BN-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 100


可能最后BN是最佳方案

2023-04-22 00:59:22,470 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 229
2023-04-22 00:59:22,470 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-22 00:59:22,470 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.14419
2023-04-22 00:59:22,470 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 252.51999
2023-04-22 00:59:22,470 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.06719
2023-04-22 00:59:22,470 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.15933
2023-04-22 00:59:22,471 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.29598
2023-04-22 00:59:22,471 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-22 01:02:59,796 - run_pharm8k-28_no_dgi.py - [INFO] - 验证:
2023-04-22 01:02:59,797 - run_pharm8k-28_no_dgi.py - [INFO] - Epoch:241  time 3.0m  LR:0.0010000000
2023-04-22 01:02:59,797 - run_pharm8k-28_no_dgi.py - [INFO] - Train Loss:0.8414448655  Valid Loss:1.6245297024
2023-04-22 01:02:59,797 - run_pharm8k-28_no_dgi.py - [INFO] - Valid MRR:0.13539  Valid MR:283.63643
2023-04-22 01:02:59,797 - run_pharm8k-28_no_dgi.py - [INFO] - Valid H@1:0.06543  Valid H@3:0.14635  Valid H@10:0.27280
2023-04-22 01:02:59,797 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-22 01:06:36,243 - run_pharm8k-28_no_dgi.py - [INFO] - 验证:
2023-04-22 01:06:36,243 - run_pharm8k-28_no_dgi.py - [INFO] - Epoch:242  time 3.0m  LR:0.0010000000
2023-04-22 01:06:36,243 - run_pharm8k-28_no_dgi.py - [INFO] - Train Loss:0.8471506951  Valid Loss:1.5274067060
2023-04-22 01:06:36,243 - run_pharm8k-28_no_dgi.py - [INFO] - Valid MRR:0.14411  Valid MR:268.86136
2023-04-22 01:06:36,244 - run_pharm8k-28_no_dgi.py - [INFO] - Valid H@1:0.07002  Valid H@3:0.15761  Valid H@10:0.28936
2023-04-22 01:06:36,244 - run_pharm8k-28_no_dgi.py - [INFO] -


Epoch = 245时出现inf




tmux a -t cmgat2 不单位化，而是缩放，最后BN，使用动态学习率,弱了一点
CUDA_VISIBLE_DEVICES=2 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-BN-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 100 --change_lr 1 --optimizer adam

2023-04-23 09:04:09,618 - run_pharm8k-28_no_dgi.py - [INFO] - Early Stopping!!
2023-04-23 09:04:09,618 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 602
2023-04-23 09:04:09,618 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0003425067
2023-04-23 09:04:09,618 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.16889
2023-04-23 09:04:09,618 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 237.69922
2023-04-23 09:04:09,618 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.08610
2023-04-23 09:04:09,618 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.18988
2023-04-23 09:04:09,618 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.33103
2023-04-23 09:04:09,619 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-23 09:04:21,216 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-04-23 09:04:21,216 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.16773
2023-04-23 09:04:21,216 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 236.62979
2023-04-23 09:04:21,216 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.08544
2023-04-23 09:04:21,216 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.18815
2023-04-23 09:04:21,216 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.32862



tmux a -t cmgat3 缩放，单位化，最后BN，使用动态学习率
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 1000 --change_lr 1 --optimizer adam


2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 971
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0000020736
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.17413
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 231.30679
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.09175
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.19561
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.33483
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-27 13:20:03,668 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-04-27 13:20:03,668 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.17318
2023-04-27 13:20:03,668 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 233.22414
2023-04-27 13:20:03,668 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.09127
2023-04-27 13:20:03,668 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.19458
2023-04-27 13:20:03,668 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.33270




tmux a -t cmgat4 缩放，单位化，最后LN，使用动态学习率
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-LN-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 1000 --change_lr 1 --optimizer adam


2023-04-23 23:26:32,130 - run_pharm8k-28_no_dgi.py - [INFO] - 验证:
2023-04-23 23:26:32,130 - run_pharm8k-28_no_dgi.py - [INFO] - Epoch:200  time 6.0m  LR:0.0009045085
2023-04-23 23:26:32,130 - run_pharm8k-28_no_dgi.py - [INFO] - Train Loss:1.2687979894  Valid Loss:1.8914181805
2023-04-23 23:26:32,130 - run_pharm8k-28_no_dgi.py - [INFO] - Valid MRR:0.11112  Valid MR:310.17746
2023-04-23 23:26:32,130 - run_pharm8k-28_no_dgi.py - [INFO] - Valid H@1:0.05192  Valid H@3:0.11501  Valid H@10:0.22628
2023-04-23 23:26:32,130 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-23 23:26:32,130 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 151
2023-04-23 23:26:32,131 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0009447879
2023-04-23 23:26:32,131 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.11471
2023-04-23 23:26:32,131 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 297.08094
2023-04-23 23:26:32,131 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.05538
2023-04-23 23:26:32,131 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.11783
2023-04-23 23:26:32,131 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.23017

出现了inf， LN不如BN










tmux a -t cmgat4 clamp[-1, 1]归一化，最后LN，使用静态学习率,这种方法不行
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name NoChangeLR-Clamp-LN-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 1000 --change_lr 0 --optimizer adam




现在有一个直接的问题：对比损失出现nan，意味着某协助特别大溢出了,有无穷inf。是不是神经网络的问题呢？此时可以启动LKGNN了




另外如果不是神经网络的问题，则按照多交互的异构Transforemr来组织数据集






i



对比学习+全采样：


基本结论：缩放的后CLoss效果不好，同时依旧在后期出现nan， inf

tmux a -t cmagt2, 对比学习 + 使用全部样本，出现了nan. 依旧出现了nan
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-full-sample --score_func conve --subgraph_loss_rate 0


file name: ?? 误删了，罢了反正也出现了NAN
再跑
不缩放对比学习，nan
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-full-sample-Tem0.2 --score_func conve --subgraph_loss_rate 0


2023-04-10 11:10:00,282 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 53
2023-04-10 11:10:00,282 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-10 11:10:00,282 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.09571
2023-04-10 11:10:00,282 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 909.81736
2023-04-10 11:10:00,283 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.05487
2023-04-10 11:10:00,283 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.09966
2023-04-10 11:10:00,283 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.17337
2023-04-10 11:10:00,283 - run_pharm8k-28_no_dgi.py - [INFO] -





tmux a -t cmagt5, 对比学习 + 使用全部样本 + 温度系数 = 0.5, 出现了nan
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name CLoss-full-sample-Tem0.5 --score_func conve  --temperature 0.5 --subgraph_loss_rate 0


file name: 
workdir/LP_CLoss-full-sample-Tem0.5_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_08_04_2023_16_25_33/LP_CLoss-full-sample-Tem0.5_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_08_04_2023_16_25_33.log



2023-04-10 11:33:55,052 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 258
2023-04-10 11:33:55,052 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-10 11:33:55,052 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.09449
2023-04-10 11:33:55,052 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 703.74899
2023-04-10 11:33:55,052 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.05212
2023-04-10 11:33:55,052 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.09685
2023-04-10 11:33:55,052 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.17560
2023-04-10 11:33:55,052 - run_pharm8k-28_no_dgi.py - [INFO] -











对比损失+正样本最大化损失：


现在有个问题：为什么子图级别使用的损失和交叉熵相加没问题，而对比损失和交叉熵确有问题？问题找到了，因为是混合损失，两者需要的打分值需要经过不同的处理，不能使用一样，我们需要两组得分值
不同的损失函数的速度不一样，BCELoss速度很快

 
tmux a -t cmgat6, 试一下混合损失， CLoss + MLoss;  效果不好 出现nan 。效果不错，比存BCELoss收敛速度快.  出现了nan.
CUDA_VISIBLE_DEVICES=2 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function mix_loss --mix_loss_mod CLoss-MLoss --use_test 1 --test_name CLoss-MLoss --score_func conve --subgraph_loss_rate 0

file name: workdir/LP_CLoss-MLoss_notext_conve_mix_loss_New_PharmKG8k-28_CLcmgat_08_04_2023_18_48_39/LP_CLoss-MLoss_notext_conve_mix_loss_New_PharmKG8k-28_CLcmgat_08_04_2023_18_48_39.log
2023-04-09 16:33:17,476 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 92
2023-04-09 16:33:17,476 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-09 16:33:17,477 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.18336
2023-04-09 16:33:17,477 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 204.22986
2023-04-09 16:33:17,477 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.10447
2023-04-09 16:33:17,477 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.20096
2023-04-09 16:33:17,477 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.33730
2023-04-09 16:33:17,477 - run_pharm8k-28_no_dgi.py - [INFO] -

不缩放对比学习，且MLoss进过softmax之后缩放,出现了nan
CUDA_VISIBLE_DEVICES=2 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function mix_loss --mix_loss_mod CLoss-MLoss --use_test 1 --test_name CLoss-MLoss --score_func conve --subgraph_loss_rate 0


2023-04-12 09:22:51,793 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 7
2023-04-12 09:22:51,793 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-12 09:22:51,793 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.06709
2023-04-12 09:22:51,793 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 688.31028
2023-04-12 09:22:51,794 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.03192
2023-04-12 09:22:51,794 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.06473
2023-04-12 09:22:51,794 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.13146
2023-04-12 09:22:51,794 - run_pharm8k-28_no_dgi.py - [INFO] -













对比损失+多标签分类损失

tmux a -t cmgat7, 试一下混合损失， CLoss + BCELoss; 这两个损失放在一起无法跑，求导，难道是连续与离散的问题？使用标签平滑？。效果不是很好，不如BCELoss
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function mix_loss --mix_loss_mod CLoss-BCELoss --use_test 1 --test_name CLoss-BCELoss --score_func conve --subgraph_loss_rate 0 

file name: workdir/LP_CLoss-BCELoss_notext_conve_mix_loss_New_PharmKG8k-28_CLcmgat_09_04_2023_05_25_15/LP_CLoss-BCELoss_notext_conve_mix_loss_New_PharmKG8k-28_CLcmgat_09_04_2023_05_25_15.log


容易出错：不跑了，效果也不好
RuntimeError: transform: failed to synchronize: cudaErrorAssert: device-side assert triggered










正样本最大化损失+多标签分类损失：

tmux a -t cmgat8, 试一下混合损失，MLoss + BCELoss 这两个损失放在一起无法跑。效果不错， 比存BCELoss收敛速度快.不缩放MLoss
CUDA_VISIBLE_DEVICES=2 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function mix_loss --mix_loss_mod MLoss-BCELoss --use_test 1 --test_name MLoss-BCELoss --score_func conve --subgraph_loss_rate 0




2023-04-14 15:01:13,292 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 866
2023-04-14 15:01:13,292 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-14 15:01:13,292 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.21817
2023-04-14 15:01:13,293 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 180.09360
2023-04-14 15:01:13,293 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.13469
2023-04-14 15:01:13,293 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.24048
2023-04-14 15:01:13,293 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.38280
2023-04-14 15:01:13,293 - run_pharm8k-28_no_dgi.py - [INFO] - 

性能和纯BCELoss差不多









基线：

tmux a -t cmgat9, 单独测试一下，新修改的方法对BCELoss是否有影响， 受缩放的影响了，性能大幅度下降。
对比损失需要缩放，而多标签分类损失需要sigmod，因此我们这些操作全部放在具体的损失函数里面，尽可能保留底层的通用性
#softmax对缩放敏感，sigmoid也敏感，因为值缩小之后趋近与0，经过sigmoid的输出都接近于0.5， 而softmax的输出也接近一样于0.16，所以不能乱缩放。
我们只对对比损失的得分值进行缩放。
注意，在CMGAT里面，之前的正样本最大化损失，其得分值其实就是没缩放的
CUDA_VISIBLE_DEVICES=2 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --optimizer adam --change_lr 0

2023-04-09 12:16:37,918 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 986
2023-04-09 12:16:37,918 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-09 12:16:37,918 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.22406
2023-04-09 12:16:37,919 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 184.18922
2023-04-09 12:16:37,919 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.14194
2023-04-09 12:16:37,919 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.24734
2023-04-09 12:16:37,919 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.38377
2023-04-09 12:16:37,919 - run_pharm8k-28_no_dgi.py - [INFO] -

2023-04-09 12:16:57,739 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-04-09 12:16:57,740 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.22424
2023-04-09 12:16:57,740 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 185.09950
2023-04-09 12:16:57,740 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.14171
2023-04-09 12:16:57,740 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.24827
2023-04-09 12:16:57,740 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.38272

file name: workdir/LP_notext_conve_bcel_loss_New_PharmKG8k-28_CLcmgat_08_04_2023_18_14_48/LP_notext_conve_bcel_loss_New_PharmKG8k-28_CLcmgat_08_04_2023_18_14_48.log



新改进：

tmux a -t cmgat1 缩放，先单位化，再BN，静态学习率
CUDA_VISIBLE_DEVICES=1 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name UnitVec-BN-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 100


2023-04-24 02:36:12,387 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 943
2023-04-24 02:36:12,387 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-04-24 02:36:12,387 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.17803
2023-04-24 02:36:12,388 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 230.59675
2023-04-24 02:36:12,388 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.09610
2023-04-24 02:36:12,388 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.19932
2023-04-24 02:36:12,388 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.33764
2023-04-24 02:36:12,388 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-24 02:36:27,054 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-04-24 02:36:27,055 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.17735
2023-04-24 02:36:27,055 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 230.19205
2023-04-24 02:36:27,055 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.09503
2023-04-24 02:36:27,055 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.19892
2023-04-24 02:36:27,055 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.33706


tmux a -t cmgat3 缩放，单位化，最后BN，使用动态学习率
CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 1000 --change_lr 1 --optimizer adam


2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 971
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0000020736
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.17413
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 231.30679
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.09175
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.19561
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.33483
2023-04-27 13:19:51,969 - run_pharm8k-28_no_dgi.py - [INFO] -


2023-04-27 13:20:03,668 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-04-27 13:20:03,668 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.17318
2023-04-27 13:20:03,668 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 233.22414
2023-04-27 13:20:03,668 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.09127
2023-04-27 13:20:03,668 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.19458
2023-04-27 13:20:03,668 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.33270



目前最好的是缩放，单位化，再BN，静态学习率/动态学习率


再此基础上修改dataloader，增加一个正确标签的标志位

CUDA_VISIBLE_DEVICES=3 python run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name UnitVec-BN-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 100




CUDA_VISIBLE_DEVICES=2,3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 2 --rdzv_id 2 run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name UnitVec-BN-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 100


2023-06-02 20:41:27,920 - run_pharm8k-28_no_dgi.py - [INFO] - 验证:
2023-06-02 20:41:27,921 - run_pharm8k-28_no_dgi.py - [INFO] - Epoch:31  time 14.0m  LR:0.0010000000
2023-06-02 20:41:27,922 - run_pharm8k-28_no_dgi.py - [INFO] - Train Loss:1.6903144712  Valid Loss:1.6025693692
2023-06-02 20:41:27,922 - run_pharm8k-28_no_dgi.py - [INFO] - Valid MRR:0.17869  Valid MR:202.42848
2023-06-02 20:41:27,922 - run_pharm8k-28_no_dgi.py - [INFO] - Valid H@1:0.10002  Valid H@3:0.19452  Valid H@10:0.33521
2023-06-02 20:41:27,922 - run_pharm8k-28_no_dgi.py - [INFO] - 


第32轮时出现了nan

加载模型+动态学习率

CUDA_VISIBLE_DEVICES=2,3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 2 --rdzv_id 2 run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.5  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.5 --stop_num 1000 --change_lr 1 --optimizer adam --save_path LP_UnitVec-BN-CLoss-part-sample-Tem0.5_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_02_06_2023_12_55_51

多卡训练，加载模型的时候出问题



加载模型
CUDA_VISIBLE_DEVICES=0,1,2,3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 4 --rdzv_id 4 run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.2  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.2 --stop_num 1000 --change_lr 1 --optimizer adam --save_path LP_ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.8_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_03_06_2023_20_29_36



CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.2  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.2 --stop_num 1000 --change_lr 1 --optimizer adam --save_path LP_ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.8_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_03_06_2023_20_29_36


CUDA_VISIBLE_DEVICES=0,1,2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 3 --rdzv_id 3 run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.2  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.2 --stop_num 1000 --change_lr 1 --optimizer adam --save_path LP_ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.8_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_03_06_2023_20_29_36




使用静态学习率把

CUDA_VISIBLE_DEVICES=0,1,2,3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 4 --rdzv_id 4 run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.2  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.2 --stop_num 100 --change_lr 0 --optimizer adam --save_path LP_ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.2_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_05_06_2023_23_39_29



CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.2  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.2 --stop_num 100 --change_lr 0 --optimizer adam --save_path LP_ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.2_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_05_06_2023_17_33_58




使用动态学习率 + 连续10epoch没有上升则温度系数从1开始，每次衰减0.05

CUDA_VISIBLE_DEVICES=0,1,2,3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 4 --rdzv_id 4 run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.05  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 0.05 --stop_num 100 --change_lr 1 --optimizer adam --save_path LP_ChangeLR-UnitVec-BN-CLoss-part-sample-Tem0.2_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_05_06_2023_23_39_29





使用动态学习率 + 连续10epoch没有上升则温度系数从1开始，每次衰减0.05,如果是从头训练，设置的温度系数太小不好，出现nan。加载预训练模型，温度系数需要由小到变化，如果是从头训练则需要从大到小

tmux a -t ph8k
ssh scx6266@paraai-n32-h-01-agent-15
conda activate GNN
module load bazel/3.7.2
module load compilers/cuda/11.3
module load compilers/gcc/9.3.0
module load nccl/2.17.1-1_cuda11.3
cd /home/bingxing2/home/scx6266/GNN/new_达到实验结果的CMGAT
export LD_PRELOAD=$LD_PRELOAD:/home/bingxing2/home/scx6266/.conda/envs/geodiff/lib/python3.8/site-packages/sklearn/__check_build/../../scikit_learn.libs/libgomp-d22c30c5.so.1.0.0


从头跑，温度系数从1.0开始 tmux a -t ph8k2 先停一下，太慢了

CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-BN-CLoss-part-sample-Tem1.0  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 1.0 --stop_num 100 --change_lr 1 --optimizer adam 



在160上跑

tmux a -t ph8k + 静态学习率 跑
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-BN-CLoss-part-sample-Tem1.0  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 1.0 --stop_num 100 --change_lr 0 --optimizer adam 




2023-06-15 17:52:39,387 - run_pharm8k-28_no_dgi.py - [INFO] - Early Stopping!!
2023-06-15 17:52:39,387 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 372
2023-06-15 17:52:39,387 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-06-15 17:52:39,387 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.29487
2023-06-15 17:52:39,388 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 189.40431
2023-06-15 17:52:39,388 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.22638
2023-06-15 17:52:39,388 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.31287
2023-06-15 17:52:39,388 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.42570
2023-06-15 17:52:39,388 - run_pharm8k-28_no_dgi.py - [INFO] - 


state['optimizer']: dict_keys(['state', 'param_groups'])
2023-06-15 17:52:51,318 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-06-15 17:52:51,319 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.29557
2023-06-15 17:52:51,319 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 191.77486
2023-06-15 17:52:51,319 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.22771
2023-06-15 17:52:51,319 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.31246
2023-06-15 17:52:51,319 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.42417
2023-06-15 17:52:51,319 - run_pharm8k-28_no_dgi.py - [INFO] - 程序终止时间:Thu Jun 15 17:52:51 2023
file name: LP_ChangeLR-UnitVec-BN-CLoss-part-sample-Tem1.0_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_11_06_2023_19_46_33






在没有泄露的情况下跑

tmux a -t ph8k2 + 动态学习率，停了
CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_pharm8k-28_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-BN-CLoss-part-sample-Tem1.0  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 1.0 --stop_num 1000 --change_lr 1 --optimizer adam 




2023-07-05 22:12:44,297 - run_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 650
2023-07-05 22:12:44,297 - run_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0002445459
2023-07-05 22:12:44,297 - run_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.21462
2023-07-05 22:12:44,297 - run_pharm8k-28_no_dgi.py - [INFO] - best_mr: 179.87990
2023-07-05 22:12:44,298 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.12308
2023-07-05 22:12:44,298 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.24217
2023-07-05 22:12:44,298 - run_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.39423
2023-07-05 22:12:44,298 - run_pharm8k-28_no_dgi.py - [INFO] - 


2023-07-05 22:12:56,317 - run_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-07-05 22:12:56,317 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.21489
2023-07-05 22:12:56,317 - run_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 181.65749
2023-07-05 22:12:56,317 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.12341
2023-07-05 22:12:56,318 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.24279
2023-07-05 22:12:56,318 - run_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.39349
2023-07-05 22:12:56,318 - run_pharm8k-28_no_dgi.py - [INFO] - 程序终止时间:Wed Jul  5 22:12:56 2023
2023-07-05 22:12:56,333 - run_pharm8k-28_no_dgi.py - [INFO] - file name: LP_ChangeLR-UnitVec-BN-CLoss-part-sample-Tem1.0_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_23_06_2023_19_28_05


无法复现这个结果，收敛速度太快了，使用动态学习率再试一下 tmux a -t test4

tmux a -t test4 + 动态学习率 160上
CUDA_VISIBLE_DEVICES=3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name ChangeLR-UnitVec-BN-CLoss-part-sample-Tem1.0  --score_func conve --subgraph_loss_rate 0 --sample_mod part --temperature 1.0 --stop_num 1000 --change_lr 1 --optimizer adam --neg_sample_num 100
无法复现













conda activate GNN
module load bazel/3.7.2
module load compilers/cuda/11.3
module load compilers/gcc/9.3.0
module load nccl/2.17.1-1_cuda11.3
export LD_PRELOAD=$LD_PRELOAD:/home/bingxing2/home/scx6266/.conda/envs/GNN/lib/python3.8/site-packages/sklearn/__check_build/../../scikit_learn.libs/libgomp-d22c30c5.so.1.0.0



在PHarmkg上做实验

消融实验，测试模型在不同的损失函数下的结果，CL，BCLoss，MPL, 最大间隔 #contrastive_loss', 'mask_softmax', 'mix_loss','bcel_loss', 'magr_loss'


tmux a -t test4  mask_softmax 160
CUDA_VISIBLE_DEVICES=3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function mask_softmax --use_test 1 --test_name  ReLU6-conve-mask_softmax --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log



 CUDA_VISIBLE_DEVICES=0 python -m torch.distributed.launch --nproc_per_node=1 --master_port 29601 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function mask_softmax --use_test 1 --test_name  ReLU6-conve-mask_softmax --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log


scikit-learn有问题
需要声明一下
export LD_PRELOAD=$LD_PRELOAD:/home/fanzhiguang/anaconda3/envs/GNN2/lib/python3.8/site-packages/sklearn/__check_build/../../scikit_learn.libs/libgomp-d22c30c5.so.1.0.0

2023-08-29 09:27:11,777 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-08-29 09:27:11,777 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 243
2023-08-29 09:27:11,777 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-08-29 09:27:11,777 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.20456
2023-08-29 09:27:11,777 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 189.32774
2023-08-29 09:27:11,777 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.12304
2023-08-29 09:27:11,777 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.22501
2023-08-29 09:27:11,777 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.36505
2023-08-29 09:27:11,777 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-08-29 09:27:24,150 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-08-29 09:27:24,150 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.20517
2023-08-29 09:27:24,150 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 191.08970
2023-08-29 09:27:24,150 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.12401
2023-08-29 09:27:24,150 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.22621
2023-08-29 09:27:24,150 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.36255
2023-08-29 09:27:24,150 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Tue Aug 29 09:27:24 2023
file_path: /data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/LP_ReLU6-conve-mask_softmax_notext_conve_mask_softmax_New_PharmKG8k-28_CLcmgat_28_08_2023_02_48_12.log






tmux a -t test2  bcel_loss
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function bcel_loss --use_test 1 --test_name  ReLU6-conve-bcel_loss --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu

2023-08-27 03:16:35,209 - run_fb15k-237_no_dgi.py - [INFO] - 验证:
2023-08-27 03:16:35,209 - run_fb15k-237_no_dgi.py - [INFO] - Epoch:885  time 0.0m  LR:0.0010000000
2023-08-27 03:16:35,209 - run_fb15k-237_no_dgi.py - [INFO] - Train Loss:0.0040905316  Valid Loss:0.0208734730
2023-08-27 03:16:35,210 - run_fb15k-237_no_dgi.py - [INFO] - Valid MRR:0.22193  Valid MR:187.30816
2023-08-27 03:16:35,210 - run_fb15k-237_no_dgi.py - [INFO] - Valid H@1:0.14014  Valid H@3:0.24470  Valid H@10:0.38142
2023-08-27 03:16:35,210 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-08-27 03:16:35,210 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-08-27 03:16:35,210 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 834
2023-08-27 03:16:35,210 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-08-27 03:16:35,210 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22356
2023-08-27 03:16:35,210 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 186.97451
2023-08-27 03:16:35,210 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14202
2023-08-27 03:16:35,211 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24552
2023-08-27 03:16:35,211 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38252
2023-08-27 03:16:35,211 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-08-27 03:16:45,220 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-08-27 03:16:45,221 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22158
2023-08-27 03:16:45,221 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 187.20348
2023-08-27 03:16:45,221 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14051
2023-08-27 03:16:45,222 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24403
2023-08-27 03:16:45,222 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.37871
2023-08-27 03:16:45,222 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sun Aug 27 03:16:45 2023
file_path: /data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/LP_ReLU6-conve-bcel_loss_notext_conve_bcel_loss_New_PharmKG8k-28_CLcmgat_26_08_2023_20_26_56.log





tmux a -t test2  magr_loss 在160上跑，17节点太慢了
CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function magr_loss --use_test 1 --test_name  ReLU6-conve-magr_loss --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log


2023-08-31 11:20:41,176 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-08-31 11:20:41,177 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 296
2023-08-31 11:20:41,177 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-08-31 11:20:41,177 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.16388
2023-08-31 11:20:41,177 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 176.09143
2023-08-31 11:20:41,177 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.08228
2023-08-31 11:20:41,177 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.17729
2023-08-31 11:20:41,177 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.32678
2023-08-31 11:20:41,177 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-08-31 11:20:50,791 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-08-31 11:20:50,791 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.16340
2023-08-31 11:20:50,791 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 177.44708
2023-08-31 11:20:50,791 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.08213
2023-08-31 11:20:50,791 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.17600
2023-08-31 11:20:50,791 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.32559
2023-08-31 11:20:50,791 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Thu Aug 31 11:20:50 2023
file_path: /data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/LP_ReLU6-conve-magr_loss_notext_conve_magr_loss_New_PharmKG8k-28_CLcmgat_27_08_2023_23_52_32.log






tmux a -t test1  contrastive_loss 160
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6



2023-08-30 10:46:56,646 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 150
2023-08-30 10:46:56,646 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-08-30 10:46:56,646 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22005
2023-08-30 10:46:56,647 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 184.30776
2023-08-30 10:46:56,647 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.13321
2023-08-30 10:46:56,647 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24620
2023-08-30 10:46:56,647 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38728
2023-08-30 10:46:56,647 - run_fb15k-237_no_dgi.py - [INFO] - 

/data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_27_08_2023_00_25_47.log

is inf:tensor([[1.0000e-08, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [1.0000e-08,        inf,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [1.0000e-08,        inf, 1.0000e-08,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        ...,
        [1.0000e-08,        inf,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08]], device='cuda:0', grad_fn=<AddBackward0>)



测试一下

CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6 --save_path LP_ReLU6-conve-contrastive_loss_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_27_08_2023_00_25_47 --test 1
 
2023-09-01 00:13:35,336 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-01 00:13:35,336 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.21968
2023-09-01 00:13:35,336 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 184.51713
2023-09-01 00:13:35,336 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.13298
2023-09-01 00:13:35,336 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24608
2023-09-01 00:13:35,336 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38606
2023-09-01 00:13:35,336 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Fri Sep  1 00:13:35 2023
file_path: /data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_01_09_2023_00_12_58.log



再训练：
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6 --save_path LP_ReLU6-conve-contrastive_loss_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_27_08_2023_00_25_47 




tmux a -t test3  contrastive_loss 160 full sample, 目前全采样效果好点
CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-fullsample --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6


2023-08-29 11:23:16,432 - run_fb15k-237_no_dgi.py - [INFO] - 验证:
2023-08-29 11:23:16,433 - run_fb15k-237_no_dgi.py - [INFO] - Epoch:160  time 10.0m  LR:0.0010000000
2023-08-29 11:23:16,433 - run_fb15k-237_no_dgi.py - [INFO] - Train Loss:5.3533158613  Valid Loss:5.5353104273
2023-08-29 11:23:16,433 - run_fb15k-237_no_dgi.py - [INFO] - Valid MRR:0.19435  Valid MR:230.47112
2023-08-29 11:23:16,433 - run_fb15k-237_no_dgi.py - [INFO] - Valid H@1:0.11755  Valid H@3:0.21230  Valid H@10:0.34541
2023-08-29 11:23:16,433 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-08-29 11:23:16,433 - run_fb15k-237_no_dgi.py - [INFO] - temperature decay on saturation, updated value of temperature 1.3877787807814457e-16
2023-08-29 11:23:16,433 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-08-29 11:23:16,434 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 120
2023-08-29 11:23:16,434 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-08-29 11:23:16,434 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22200
2023-08-29 11:23:16,434 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 190.53066
2023-08-29 11:23:16,434 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.13979
2023-08-29 11:23:16,434 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24484
2023-08-29 11:23:16,434 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38239
2023-08-29 11:23:16,434 - run_fb15k-237_no_dgi.py - [INFO] - 
存在下溢出

/data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss-fullsample_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_28_08_2023_00_14_41.log


加载模型，再训练，把1e-8改成1e-5

CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-fullsample --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6 --save_path LP_ReLU6-conve-contrastive_loss-fullsample_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_28_08_2023_00_14_41


2023-08-30 07:10:36,205 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 90
2023-08-30 07:10:36,206 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-08-30 07:10:36,206 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22547
2023-08-30 07:10:36,206 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 193.29892
2023-08-30 07:10:36,206 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14197
2023-08-30 07:10:36,206 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24946
2023-08-30 07:10:36,206 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38799
2023-08-30 07:10:36,206 - run_fb15k-237_no_dgi.py - [INFO] - 


is nan:tensor([[nan, nan, nan,  ..., nan, nan, nan],
        [nan, nan, nan,  ..., nan, nan, nan],
        [nan, nan, nan,  ..., nan, nan, nan],
        ...,
        [nan, nan, nan,  ..., nan, nan, nan],
        [nan, nan, nan,  ..., nan, nan, nan],
        [nan, nan, nan,  ..., nan, nan, nan]], device='cuda:0',
       grad_fn=<ExpBackward0>)

依旧有问题

/data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/ReLU6-conve-contrastive_loss-fullsample_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_29_08_2023_11_54_53.log


再跑

CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-fullsample --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6 --save_path LP_ReLU6-conve-contrastive_loss-fullsample_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_29_08_2023_11_54_53


测试一下：

CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-fullsample --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6 --save_path LP_ReLU6-conve-contrastive_loss-fullsample_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_29_08_2023_11_54_53 --test 1


2023-09-01 10:00:31,976 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-01 10:00:31,976 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22547
2023-09-01 10:00:31,976 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 193.50573
2023-09-01 10:00:31,977 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14296
2023-09-01 10:00:31,977 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24835
2023-09-01 10:00:31,977 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38658
2023-09-01 10:00:31,977 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Fri Sep  1 10:00:31 2023
file_path: /data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss-fullsample_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_01_09_2023_09_59_54.log




改进的对比损失，效果一般：
2023-09-02 02:19:22,322 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-02 02:19:22,322 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 9
2023-09-02 02:19:22,322 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-02 02:19:22,322 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.20168
2023-09-02 02:19:22,322 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 201.93087
2023-09-02 02:19:22,322 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.12020
2023-09-02 02:19:22,322 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.22283
2023-09-02 02:19:22,322 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.35938
2023-09-02 02:19:22,322 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-02 02:19:33,194 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-02 02:19:33,195 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.20181
2023-09-02 02:19:33,195 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 203.19037
2023-09-02 02:19:33,195 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.12124
2023-09-02 02:19:33,195 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.22152
2023-09-02 02:19:33,195 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.35989
2023-09-02 02:19:33,195 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep  2 02:19:33 2023
file_path: /data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss-fullsample_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_01_09_2023_15_51_15.log





在节点17上

杨老师的HRGAT模型在New_PharmKG8k-28的效果

here 48008

Current iteration time 2349.0382549762726
Stats for replacing head are -> 
Current iteration Hits@100 are 0.5995875687385436
Current iteration Hits@10 are 0.26435177470421595
Current iteration Hits@3 are 0.14285119146808864
Current iteration Hits@1 are 0.0631353107815364
Current iteration Mean rank 294.91076487252127
Current iteration Mean Reciprocal Rank 0.13159861677726703

Stats for replacing tail are -> 
Current iteration Hits@100 are 0.636685552407932
Current iteration Hits@10 are 0.2778911848025329
Current iteration Hits@3 are 0.14610064989168473
Current iteration Hits@1 are 0.06311448091984669
Current iteration Mean rank 247.73285702382935
Current iteration Mean Reciprocal Rank 0.13565470567418422

Averaged stats for replacing head are -> 
Hits@100 are 0.5995875687385436
Hits@10 are 0.26435177470421595
Hits@3 are 0.14285119146808864
Hits@1 are 0.0631353107815364
Mean rank 294.91076487252127
Mean Reciprocal Rank 0.13159861677726703

Averaged stats for replacing tail are -> 
Hits@100 are 0.636685552407932
Hits@10 are 0.2778911848025329
Hits@3 are 0.14610064989168473
Hits@1 are 0.06311448091984669
Mean rank 247.73285702382935
Mean Reciprocal Rank 0.13565470567418422

Cumulative stats are -> 
Hits@100 are 0.6181365605732378
Hits@10 are 0.2711214797533744
Hits@3 are 0.14447592067988668
Hits@1 are 0.06312489585069155
Mean rank 271.3218109481753
Mean Reciprocal Rank 0.13362666122572564


继续在 DRKG数据集上 tmux a -t pharmkg

Current iteration time 6695.9282150268555
Stats for replacing head are -> 
Current iteration Hits@100 are 0.9259665392568457
Current iteration Hits@10 are 0.8273231405476533
Current iteration Hits@3 are 0.7513628673475782
Current iteration Hits@1 are 0.650542013910646
Current iteration Mean rank 113.66771100946174
Current iteration Mean Reciprocal Rank 0.713522142019938

Stats for replacing tail are -> 
Current iteration Hits@100 are 0.8994297888338868
Current iteration Hits@10 are 0.7489504354909455
Current iteration Hits@3 are 0.6003508991791465
Current iteration Hits@1 are 0.39054765336173947
Current iteration Mean rank 130.4900683000188
Current iteration Mean Reciprocal Rank 0.5181723022623236

Averaged stats for replacing head are -> 
Hits@100 are 0.9259665392568457
Hits@10 are 0.8273231405476533
Hits@3 are 0.7513628673475782
Hits@1 are 0.650542013910646
Mean rank 113.66771100946174
Mean Reciprocal Rank 0.713522142019938

Averaged stats for replacing tail are -> 
Hits@100 are 0.8994297888338868
Hits@10 are 0.7489504354909455
Hits@3 are 0.6003508991791465
Hits@1 are 0.39054765336173947
Mean rank 130.4900683000188
Mean Reciprocal Rank 0.5181723022623236

Cumulative stats are -> 
Hits@100 are 0.9126981640453662
Hits@10 are 0.7881367880192994
Hits@3 are 0.6758568832633624
Hits@1 are 0.5205448336361927
Mean rank 122.07888965474027
Mean Reciprocal Rank 0.6158472221411309

这个数据集偏高呀，再跑一次

tmux a -t pharmkg2 在186上，结果还是一样

Current iteration time 9052.308382749557
Stats for replacing head are -> 
Current iteration Hits@100 are 0.9261858512438123
Current iteration Hits@10 are 0.8270881634187606
Current iteration Hits@3 are 0.7500939908515571
Current iteration Hits@1 are 0.6502287110721223
Current iteration Mean rank 109.40618146500407
Current iteration Mean Reciprocal Rank 0.712722367368176

Stats for replacing tail are -> 
Current iteration Hits@100 are 0.9001973807882699
Current iteration Hits@10 are 0.7406009148442885
Current iteration Hits@3 are 0.5904035340560185
Current iteration Hits@1 are 0.39653173757754245
Current iteration Mean rank 122.76145121874804
Current iteration Mean Reciprocal Rank 0.5156354791986957

Averaged stats for replacing head are -> 
Hits@100 are 0.9261858512438123
Hits@10 are 0.8270881634187606
Hits@3 are 0.7500939908515571
Hits@1 are 0.6502287110721223
Mean rank 109.40618146500407
Mean Reciprocal Rank 0.712722367368176

Averaged stats for replacing tail are -> 
Hits@100 are 0.9001973807882699
Hits@10 are 0.7406009148442885
Hits@3 are 0.5904035340560185
Hits@1 are 0.39653173757754245
Mean rank 122.76145121874804
Mean Reciprocal Rank 0.5156354791986957

Cumulative stats are -> 
Hits@100 are 0.9131916160160412
Hits@10 are 0.7838445391315245
Hits@3 are 0.6702487624537878
Hits@1 are 0.5233802243248324
Mean rank 116.08381634187606
Mean Reciprocal Rank 0.6141789232834358




再一次：

Current iteration time 8798.42994427681
Stats for replacing head are -> 
Current iteration Hits@100 are 0.9259978695406981
Current iteration Hits@10 are 0.8290149758756814
Current iteration Hits@3 are 0.7552634876871984
Current iteration Hits@1 are 0.6546149508114544
Current iteration Mean rank 109.60826179585187
Current iteration Mean Reciprocal Rank 0.7170964995014404

Stats for replacing tail are -> 
Current iteration Hits@100 are 0.9011842847296196
Current iteration Hits@10 are 0.7513315370637258
Current iteration Hits@3 are 0.610000626605677
Current iteration Hits@1 are 0.4365718403408735
Current iteration Mean rank 124.04242120433611
Current iteration Mean Reciprocal Rank 0.5456977869398447

Averaged stats for replacing head are -> 
Hits@100 are 0.9259978695406981
Hits@10 are 0.8290149758756814
Hits@3 are 0.7552634876871984
Hits@1 are 0.6546149508114544
Mean rank 109.60826179585187
Mean Reciprocal Rank 0.7170964995014404

Averaged stats for replacing tail are -> 
Hits@100 are 0.9011842847296196
Hits@10 are 0.7513315370637258
Hits@3 are 0.610000626605677
Hits@1 are 0.4365718403408735
Mean rank 124.04242120433611
Mean Reciprocal Rank 0.5456977869398447

Cumulative stats are -> 
Hits@100 are 0.9135910771351589
Hits@10 are 0.7901732564697036
Hits@3 are 0.6826320571464377
Hits@1 are 0.5455933955761639
Mean rank 116.825341500094
Mean Reciprocal Rank 0.6313971432206426



BIOKG数据集上 tmux a -t pharmkg2 在186上

Current iteration time 74687.787763834
Stats for replacing head are -> 
Current iteration Hits@100 are 0.6599192759295499
Current iteration Hits@10 are 0.2771526418786693
Current iteration Hits@3 are 0.16050461280402573
Current iteration Hits@1 are 0.09437028235951915
Current iteration Mean rank 172.82538614760972
Current iteration Mean Reciprocal Rank 0.15696067355350948

Stats for replacing tail are -> 
Current iteration Hits@100 are 0.21020582890690523
Current iteration Hits@10 are 0.09365389991613084
Current iteration Hits@3 are 0.05033897120492033
Current iteration Hits@1 are 0.026724559686888454
Current iteration Mean rank 10322.178676265026
Current iteration Mean Reciprocal Rank 0.048889175724797854

Averaged stats for replacing head are -> 
Hits@100 are 0.6599192759295499
Hits@10 are 0.2771526418786693
Hits@3 are 0.16050461280402573
Hits@1 are 0.09437028235951915
Mean rank 172.82538614760972
Mean Reciprocal Rank 0.15696067355350948

Averaged stats for replacing tail are -> 
Hits@100 are 0.21020582890690523
Hits@10 are 0.09365389991613084
Hits@3 are 0.05033897120492033
Hits@1 are 0.026724559686888454
Mean rank 10322.178676265026
Mean Reciprocal Rank 0.048889175724797854

Cumulative stats are -> 
Hits@100 are 0.43506255241822755
Hits@10 are 0.18540327089740005
Hits@3 are 0.10542179200447302
Hits@1 are 0.060547421023203804
Mean rank 5247.502031206318
Mean Reciprocal Rank 0.10292492463915368



把CompGCN该造成对比学习，在PHarmkg数据集上 节点17 tmux a -t compgcn

CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_compgcn_pharm8k-28_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6



compgcn在186上试试 tmux a -t compgcn

CUDA_VISIBLE_DEVICES=3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_compgcn_pharm8k-28_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6

2023-08-29 01:29:23,431 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 98
2023-08-29 01:29:23,431 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-08-29 01:29:23,432 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.18738
2023-08-29 01:29:23,432 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_mr: 213.93181
2023-08-29 01:29:23,432 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.10694
2023-08-29 01:29:23,432 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.20840
2023-08-29 01:29:23,432 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.34215
2023-08-29 01:29:23,432 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - 


2023-08-29 01:41:40,842 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - 验证:
2023-08-29 01:41:40,843 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - Epoch:131  time 12.0m  LR:0.0010000000
2023-08-29 01:41:40,843 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - Train Loss:5.8911937697  Valid Loss:5.6532470744
2023-08-29 01:41:40,843 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - Valid MRR:0.16262  Valid MR:231.24796
2023-08-29 01:41:40,843 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - Valid H@1:0.08664  Valid H@3:0.17948  Valid H@10:0.31158
2023-08-29 01:41:40,843 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] -

CL存在下溢出
/mnt/home/fanzhiguang/186/GNN/医学GNN/CL-CompGCN/pharm8k_log/LP_ReLU6-conve-contrastive_loss_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_27_08_2023_22_53_58.log
不过基本上也到头了
可以使用这些信息画图了，此外，既然出现下溢出，那么就把10-8改成10-5变大些，之后再加载模型再训练试试效果。


加载模型：LP_ReLU6-conve-contrastive_loss_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_27_08_2023_22_53_58

CUDA_VISIBLE_DEVICES=3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_compgcn_pharm8k-28_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-retrain --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6 --save_path LP_ReLU6-conve-contrastive_loss_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_27_08_2023_22_53_58



2023-09-01 06:32:21,443 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - Early Stopping!!
2023-09-01 06:32:21,443 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_epoch: 123
2023-09-01 06:32:21,444 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-01 06:32:21,444 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_mrr: 0.19314
2023-09-01 06:32:21,444 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_mr: 207.27472
2023-09-01 06:32:21,444 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_hit1: 0.11112
2023-09-01 06:32:21,444 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_hit3: 0.21561
2023-09-01 06:32:21,444 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - best_hit10: 0.35313
2023-09-01 06:32:21,444 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - 


2023-09-01 06:32:38,415 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - 测试:
2023-09-01 06:32:38,416 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - Test_mrr: 0.19366
2023-09-01 06:32:38,416 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - Test_mr: 208.12107
2023-09-01 06:32:38,416 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - Test_hit1: 0.11179
2023-09-01 06:32:38,416 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - Test_hit3: 0.21615
2023-09-01 06:32:38,416 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - Test_hit10: 0.35211
2023-09-01 06:32:38,416 - run_compgcn_pharm8k-28_no_dgi.py - [INFO] - 程序终止时间:Fri Sep  1 06:32:38 2023
file_path: /mnt/home/fanzhiguang/186/GNN/医学GNN/CL-CompGCN/pharm8k_log/LP_ReLU6-conve-contrastive_loss-retrain_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_29_08_2023_10_25_41.log









SE-GNN在17上
conda activate geodiff

#New_PharmKG8k-28 tmux a -t segnn
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 /home/bingxing2/home/scx6266/GNN/new_SE-GNN/code/run.py dataset=New_PharmKG8k_28


环境有问题，某些包版本有问题，段错误

解决办法：

omegaconf
hydra-core 
很有可能是DGL版本问题导致的段错误,的确如此
conda install -c dglteam dgl-cuda11.1

查看DGL对应的CUDA版本 https://conda.anaconda.org/dglteam/linux-64

[2023-08-29 02:18:22,479][root][INFO] - Epoch: 107 | Loss: 4.8086 | Val - MRR: 0.2123, MR:  197.78, H@1: 0.130, H@3: 0.236, H@10: 0.370 | Test - MRR: 0.2128 | *
[2023-08-29 02:32:09,149][root][INFO] - Epoch: 108 | Loss: 4.8022 | Val - MRR: 0.1833, MR:  212.56, H@1: 0.108, H@3: 0.198, H@10: 0.331 | 
[2023-08-29 02:45:54,830][root][INFO] - Epoch: 109 | Loss: 4.7962 | Val - MRR: 0.1859, MR:  231.55, H@1: 0.107, H@3: 0.206, H@10: 0.340 | 
[2023-08-29 02:59:38,290][root][INFO] - Epoch: 110 | Loss: 4.7920 | Val - MRR: 0.2038, MR:  207.25, H@1: 0.121, H@3: 0.227, H@10: 0.364 |  
[2023-08-29 03:13:23,341][root][INFO] - Epoch: 111 | Loss: 4.7900 | Val - MRR: 0.1762, MR:  256.84, H@1: 0.101, H@3: 0.193, H@10: 0.323 |  
[2023-08-29 03:27:08,076][root][INFO] - Epoch: 112 | Loss: 4.7795 | Val - MRR: 0.2097, MR:  201.62, H@1: 0.127, H@3: 0.233, H@10: 0.369 | 
[2023-08-29 03:40:54,824][root][INFO] - Epoch: 113 | Loss: 4.8274 | Val - MRR: 0.1908, MR:  211.67, H@1: 0.114, H@3: 0.208, H@10: 0.341 | 
[2023-08-29 03:54:39,016][root][INFO] - Epoch: 114 | Loss: 4.8010 | Val - MRR: 0.2089, MR:  204.36, H@1: 0.127, H@3: 0.231, H@10: 0.367 |  
[2023-08-29 04:08:26,411][root][INFO] - Epoch: 115 | Loss: 4.7916 | Val - MRR: 0.2119, MR:  199.92, H@1: 0.131, H@3: 0.234, H@10: 0.368 | 
[2023-08-29 04:22:12,948][root][INFO] - Epoch: 116 | Loss: 4.7815 | Val - MRR: 0.2054, MR:  206.57, H@1: 0.124, H@3: 0.228, H@10: 0.364 | 
[2023-08-29 04:35:59,580][root][INFO] - Epoch: 117 | Loss: 4.7762 | Val - MRR: 0.1672, MR:  279.99, H@1: 0.095, H@3: 0.183, H@10: 0.306 | 
[2023-08-29 04:49:45,738][root][INFO] - Epoch: 118 | Loss: 4.9640 | Val - MRR: 0.1566, MR:  302.62, H@1: 0.089, H@3: 0.171, H@10: 0.287 | 
[2023-08-29 05:03:31,833][root][INFO] - Epoch: 119 | Loss: 4.8763 | Val - MRR: 0.1534, MR:  315.33, H@1: 0.086, H@3: 0.166, H@10: 0.284 |  
[2023-08-29 05:17:16,468][root][INFO] - Epoch: 120 | Loss: 4.8527 | Val - MRR: 0.2089, MR:  212.55, H@1: 0.129, H@3: 0.230, H@10: 0.366 | 
[2023-08-29 05:30:54,062][root][INFO] - Epoch: 121 | Loss: 4.8414 | Val - MRR: 0.1929, MR:  215.71, H@1: 0.116, H@3: 0.211, H@10: 0.344 | 
[2023-08-29 05:44:36,571][root][INFO] - Epoch: 122 | Loss: 4.8277 | Val - MRR: 0.1424, MR:  270.51, H@1: 0.078, H@3: 0.150, H@10: 0.270 |

/home/bingxing2/home/scx6266/GNN/new_SE-GNN/data/output/New_PharmKG8k_28/2023-08-28/01-21-08/run.log
CL存在下溢出， 不过基本上也到头了
可以使用这些信息画图了，此外，既然出现下溢出，那么就把10-8改成10-5变大些，之后再加载模型再训练试试效果。


加载模型再训练，/home/bingxing2/home/scx6266/GNN/new_SE-GNN/data/output/New_PharmKG8k_28/2023-08-28/01-21-08/checkpoint.torch

CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 /home/bingxing2/home/scx6266/GNN/new_SE-GNN/code/run.py dataset=New_PharmKG8k_28 save_path=/home/bingxing2/home/scx6266/GNN/new_SE-GNN/data/output/New_PharmKG8k_28/2023-08-28/01-21-08/checkpoint.torch





评估：如果仅仅为了评估，则epoch=0
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 /home/bingxing2/home/scx6266/GNN/new_SE-GNN/code/run.py dataset=New_PharmKG8k_28 save_path=/home/bingxing2/home/scx6266/GNN/new_SE-GNN/data/output/New_PharmKG8k_28/2023-08-29/10-45-55/checkpoint.torch epoch=0 only_test=1 max_no_improve=10

[2023-08-30 20:19:25,137][root][INFO] - Train metrics ...
[2023-08-30 20:20:12,463][root][INFO] - Train (head) - MRR: 0.4249, MR:   73.06, H@1: 0.334, H@3: 0.466, H@10: 0.594
[2023-08-30 20:20:12,463][root][INFO] - Train (tail) - MRR: 0.4581, MR:   59.55, H@1: 0.363, H@3: 0.502, H@10: 0.634
[2023-08-30 20:20:12,463][root][INFO] - Train (avg) - MRR: 0.4415, MR:   66.30, H@1: 0.349, H@3: 0.484, H@10: 0.614

[2023-08-30 20:20:12,463][root][INFO] - Valid metrics ...
[2023-08-30 20:20:28,986][root][INFO] - Valid (head) - MRR: 0.2058, MR:  210.65, H@1: 0.122, H@3: 0.232, H@10: 0.367
[2023-08-30 20:20:28,986][root][INFO] - Valid (tail) - MRR: 0.2185, MR:  180.85, H@1: 0.131, H@3: 0.243, H@10: 0.387
[2023-08-30 20:20:28,986][root][INFO] - Valid (avg) - MRR: 0.2122, MR:  195.75, H@1: 0.127, H@3: 0.237, H@10: 0.377

[2023-08-30 20:20:28,986][root][INFO] - Test metrics...
[2023-08-30 20:20:45,405][root][INFO] - Test (head) - MRR: 0.2065, MR:  212.64, H@1: 0.124, H@3: 0.232, H@10: 0.367
[2023-08-30 20:20:45,405][root][INFO] - Test (tail) - MRR: 0.2176, MR:  179.34, H@1: 0.131, H@3: 0.243, H@10: 0.387
[2023-08-30 20:20:45,405][root][INFO] - Test (avg) - MRR: 0.2120, MR:  195.99, H@1: 0.127, H@3: 0.237, H@10: 0.377

[2023-08-30 20:20:45,405][root][INFO] - Model save path: /home/bingxing2/home/scx6266/GNN/new_SE-GNN/data/output/New_PharmKG8k_28/2023-08-30/20-19-09 #用这个


再训练：
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 /home/bingxing2/home/scx6266/GNN/new_SE-GNN/code/run.py dataset=New_PharmKG8k_28 save_path=/home/bingxing2/home/scx6266/GNN/new_SE-GNN/data/output/New_PharmKG8k_28/2023-08-29/10-45-55/checkpoint.torch epoch=600 only_test=0 max_no_improve=10


[2023-09-01 05:16:46,102][root][INFO] - Train (head) - MRR: 0.4516, MR:   69.41, H@1: 0.363, H@3: 0.492, H@10: 0.615
[2023-09-01 05:16:46,103][root][INFO] - Train (tail) - MRR: 0.4885, MR:   55.83, H@1: 0.396, H@3: 0.534, H@10: 0.659
[2023-09-01 05:16:46,103][root][INFO] - Train (avg) - MRR: 0.4701, MR:   62.62, H@1: 0.380, H@3: 0.513, H@10: 0.637

[2023-09-01 05:16:46,103][root][INFO] - Valid metrics ...
[2023-09-01 05:17:03,434][root][INFO] - Valid (head) - MRR: 0.2043, MR:  215.73, H@1: 0.122, H@3: 0.229, H@10: 0.364
[2023-09-01 05:17:03,434][root][INFO] - Valid (tail) - MRR: 0.2147, MR:  184.84, H@1: 0.127, H@3: 0.240, H@10: 0.384
[2023-09-01 05:17:03,434][root][INFO] - Valid (avg) - MRR: 0.2095, MR:  200.29, H@1: 0.125, H@3: 0.234, H@10: 0.374

[2023-09-01 05:17:03,434][root][INFO] - Test metrics...
[2023-09-01 05:17:21,948][root][INFO] - Test (head) - MRR: 0.2045, MR:  218.06, H@1: 0.122, H@3: 0.230, H@10: 0.363
[2023-09-01 05:17:21,948][root][INFO] - Test (tail) - MRR: 0.2148, MR:  184.60, H@1: 0.127, H@3: 0.241, H@10: 0.382
[2023-09-01 05:17:21,948][root][INFO] - Test (avg) - MRR: 0.2096, MR:  201.33, H@1: 0.125, H@3: 0.235, H@10: 0.373

[2023-09-01 05:17:21,948][root][INFO] - Model save path: /home/bingxing2/home/scx6266/GNN/new_SE-GNN/data/output/New_PharmKG8k_28/2023-08-31/21-00
-52


从头再跑SEGNN

#New_PharmKG8k-28 tmux a -t segnn 全采样吧，速度快点
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 /home/bingxing2/home/scx6266/GNN/new_SE-GNN/code/run.py dataset=New_PharmKG8k_28 sample_mod=full




conda activate GNN
module load bazel/3.7.2
module load compilers/cuda/11.3
module load compilers/gcc/9.3.0
module load nccl/2.17.1-1_cuda11.3
cd /home/bingxing2/home/scx6266/GNN/new_CMGAT
export LD_PRELOAD=$LD_PRELOAD:/home/bingxing2/home/scx6266/.conda/envs/geodiff/lib/python3.8/site-packages/sklearn/__check_build/../../scikit_learn.libs/libgomp-d22c30c5.so.1.0.0


跑DRKG完整版数据集 节点7，tmux a -t test4

CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset DRKG --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-fullsample --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./drkg_model_save  --log_dir ./drkg_log --conve_act relu6






跑消融实验


采样： 160上
tmux a -t test1 pos sample 100
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-partsample100 --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 100 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6

2023-09-05 03:46:06,878 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 130
2023-09-05 03:46:06,878 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-05 03:46:06,878 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.19237
2023-09-05 03:46:06,878 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 176.79817
2023-09-05 03:46:06,878 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.10275
2023-09-05 03:46:06,878 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.21680
2023-09-05 03:46:06,879 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.36880
2023-09-05 03:46:06,879 - run_fb15k-237_no_dgi.py - [INFO] -

is inf:tensor([[1.0000e-08, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [1.0000e-08,        inf, 1.0000e-08,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        ...,
        [       inf,        inf,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf,        inf,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf,        inf,        inf,  ..., 1.0000e-08, 1.0000e-08,




测试：
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-partsample100 --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 100 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6 --save_path LP_ReLU6-conve-contrastive_loss-partsample100_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_03_09_2023_04_22_09  --test 1


2023-09-05 14:32:59,789 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-05 14:32:59,789 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.19296
2023-09-05 14:32:59,789 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 178.15301
2023-09-05 14:32:59,789 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.10367
2023-09-05 14:32:59,789 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.21677
2023-09-05 14:32:59,789 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.36813
2023-09-05 14:32:59,789 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Tue Sep  5 14:32:59 2023
file_path: /data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss-partsample100_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_05_09_2023_14_32_09.log


2023-09-22 08:42:05,484 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-22 08:42:05,484 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 229
2023-09-22 08:42:05,484 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-22 08:42:05,484 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.20149
2023-09-22 08:42:05,484 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 176.84430
2023-09-22 08:42:05,484 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.11063
2023-09-22 08:42:05,484 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.22650
2023-09-22 08:42:05,485 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38095
2023-09-22 08:42:05,485 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-22 08:42:12,912 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-22 08:42:12,912 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.20221
2023-09-22 08:42:12,912 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 176.57521
2023-09-22 08:42:12,912 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.11129
2023-09-22 08:42:12,913 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.22817
2023-09-22 08:42:12,913 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.37999
2023-09-22 08:42:12,913 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Fri Sep 22 08:42:12 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss-partsample100_notext_conve_contrastive_loss_New_
PharmKG8k-28_CLcmgat_19_09_2023_19_42_22.log






再跑节点7， tmux a -t test2
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-partsample100 --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 1.0 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 100 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6


2023-09-22 08:42:12,912 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-22 08:42:12,912 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.20221
2023-09-22 08:42:12,912 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 176.57521
2023-09-22 08:42:12,912 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.11129
2023-09-22 08:42:12,913 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.22817
2023-09-22 08:42:12,913 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.37999
2023-09-22 08:42:12,913 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Fri Sep 22 08:42:12 2023
2023-09-22 08:42:12,922 - run_fb15k-237_no_dgi.py - [INFO] - file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss-partsample100_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_19_09_2023_19_42_22.log
2023-09-22 08:42:12,922 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Fri Sep 22 08:42:12 2023


再测试：
2023-09-22 02:21:10,787 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-22 02:21:10,787 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 132
2023-09-22 02:21:10,787 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-22 02:21:10,787 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.21374
2023-09-22 02:21:10,787 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 185.13219
2023-09-22 02:21:10,787 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.12547
2023-09-22 02:21:10,787 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24051
2023-09-22 02:21:10,787 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38501
2023-09-22 02:21:10,787 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-22 02:21:17,199 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-22 02:21:17,202 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.21416
2023-09-22 02:21:17,202 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 185.98652
2023-09-22 02:21:17,202 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.12575
2023-09-22 02:21:17,202 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24151
2023-09-22 02:21:17,202 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38421
2023-09-22 02:21:17,203 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Fri Sep 22 02:21:17 2023
2023-09-22 02:21:17,206 - run_fb15k-237_no_dgi.py - [INFO] - file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss-partsample100_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_19_09_2023_19_40_32.log
2023-09-22 02:21:17,206 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Fri Sep 22 02:21:17 2023




tmux a -t test2 pos sample 500 
CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-partsample500 --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 500 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6



2023-09-05 16:34:29,706 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 122
2023-09-05 16:34:29,706 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-05 16:34:29,706 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.21393
2023-09-05 16:34:29,706 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 182.88671
2023-09-05 16:34:29,706 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.12564
2023-09-05 16:34:29,706 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24112
2023-09-05 16:34:29,706 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38480
2023-09-05 16:34:29,707 - run_fb15k-237_no_dgi.py - [INFO] - 

is inf:tensor([[       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf,        inf,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        ...,
        [1.0000e-08, 1.0000e-08, 1.0000e-08,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf,        inf,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [1.0000e-08, 1.0000e-08, 1.0000e-08,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08]], device='cuda:0', grad_fn=<AddBackward0>), at th None positi

测试：

CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-partsample500 --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 500 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6 --save_path LP_ReLU6-conve-contrastive_loss-partsample500_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_03_09_2023_04_22_23 --test 1
 
2023-09-05 22:21:54,040 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-05 22:21:54,040 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.21415
2023-09-05 22:21:54,040 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 184.65726
2023-09-05 22:21:54,040 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.12612
2023-09-05 22:21:54,041 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24091
2023-09-05 22:21:54,041 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38376
2023-09-05 22:21:54,041 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Tue Sep  5 22:21:54 2023
file_path: /data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss-partsample500_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_05_09_2023_22_21_06.log






再跑节点7， tmux a -t test3
CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-partsample100 --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 1.0 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 500 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6





tmux a -t test3 pos sample 1000 
CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-partsample1000 --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6


2023-09-01 00:13:35,336 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.21968
2023-09-01 00:13:35,336 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 184.51713
2023-09-01 00:13:35,336 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.13298
2023-09-01 00:13:35,336 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24608
2023-09-01 00:13:35,336 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38606
2023-09-01 00:13:35,336 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Fri Sep  1 00:13:35 2023
file_path: /data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_01_09_2023_00_12_58.log




再训练和测试：

2023-09-06 15:41:06,480 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 152
2023-09-06 15:41:06,481 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-06 15:41:06,481 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22010
2023-09-06 15:41:06,481 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 185.36613
2023-09-06 15:41:06,481 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.13349
2023-09-06 15:41:06,481 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24673
2023-09-06 15:41:06,481 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38739
2023-09-06 15:41:06,481 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-06 16:05:03,026 - run_fb15k-237_no_dgi.py - [INFO] - 验证:
2023-09-06 16:05:03,027 - run_fb15k-237_no_dgi.py - [INFO] - Epoch:181  time 23.0m  LR:0.0010000000
2023-09-06 16:05:03,027 - run_fb15k-237_no_dgi.py - [INFO] - Train Loss:3.4493683943  Valid Loss:3.6346338654
2023-09-06 16:05:03,027 - run_fb15k-237_no_dgi.py - [INFO] - Valid MRR:0.19324  Valid MR:235.16198
2023-09-06 16:05:03,028 - run_fb15k-237_no_dgi.py - [INFO] - Valid H@1:0.11483  Valid H@3:0.21403  Valid H@10:0.34500
2023-09-06 16:05:03,028 - run_fb15k-237_no_dgi.py - [INFO] -
LP_ReLU6-conve-contrastive_loss-partsample1000_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_03_09_2023_04_22_35

is inf:tensor([[       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf,        inf,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf,        inf, 1.0000e-08,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        ...,
        [       inf,        inf,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [1.0000e-08, 1.0000e-08, 1.0000e-08,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08]], device='cuda:0', grad_fn=<AddBackward0>), at th None position



测试：

CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-partsample1000 --score_func conve --subgraph_loss_rate 0.0 --sample_mod part --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6 --save_path LP_ReLU6-conve-contrastive_loss-partsample1000_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_03_09_2023_04_22_35 --test 1

2023-09-06 17:00:49,402 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-06 17:00:49,402 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22022
2023-09-06 17:00:49,402 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 185.15307
2023-09-06 17:00:49,402 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.13358
2023-09-06 17:00:49,402 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24671
2023-09-06 17:00:49,402 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38639
2023-09-06 17:00:49,402 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Wed Sep  6 17:00:49 2023
file_path: /data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss-partsample1000_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_06_09_2023_17_00_08.log





打分函数：  虚拟环境GNN2, 在186上不行，换成节点7
tmux a -t test2  transe tmux test2 bx7
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-fullsample-transe --score_func transe --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 100 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6



2023-09-04 05:13:09,846 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-04 05:13:09,846 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 15
2023-09-04 05:13:09,846 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-04 05:13:09,846 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.14100
2023-09-04 05:13:09,846 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 269.16463
2023-09-04 05:13:09,846 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.07832
2023-09-04 05:13:09,846 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.14725
2023-09-04 05:13:09,846 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.26484
2023-09-04 05:13:09,849 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-04 05:13:16,941 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-04 05:13:16,941 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.14006
2023-09-04 05:13:16,941 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 267.78298
2023-09-04 05:13:16,941 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.07682
2023-09-04 05:13:16,941 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.14657
2023-09-04 05:13:16,941 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.26343
2023-09-04 05:13:16,941 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Mon Sep  4 05:13:16 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss-fullsample-transe_notext_transe_contrastive_loss
_New_PharmKG8k-28_CLcmgat_03_09_2023_20_37_04.log




torch 1.9.1没有 torchrun只能使用传统的方法，段错的原因是tensorflow导致的，由于服务器的CUDA是11.1太老了，没有合适的tf版本，所以要降版本到10.2
CUDA_VISIBLE_DEVICES=0 python -m torch.distributed.launch --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-fullsample-transe --score_func transe --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 100 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6





tmux a -t test2  distmult tmux test4 160
CUDA_VISIBLE_DEVICES=3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-fullsample-distmult --score_func distmult --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 100 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6



2023-09-03 23:03:12,962 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 35
2023-09-03 23:03:12,963 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-03 23:03:12,963 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.17167
2023-09-03 23:03:12,963 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 245.08455
2023-09-03 23:03:12,963 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.10042
2023-09-03 23:03:12,963 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.17886
2023-09-03 23:03:12,963 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.31738
2023-09-03 23:03:12,963 - run_fb15k-237_no_dgi.py - [INFO] - 


is inf:tensor([[       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf,        inf,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        ...,
        [       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08]], device='cuda:0', grad_fn=<AddBackward0>), at th None position


测试：
CUDA_VISIBLE_DEVICES=3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-fullsample-distmult --score_func distmult --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 100 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6 --save_path LP_ReLU6-conve-contrastive_loss-fullsample-distmult_notext_distmult_contrastive_loss_New_PharmKG8k-28_CLcmgat_03_09_2023_04_51_18 --test 1

2023-09-03 23:29:26,772 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-03 23:29:26,772 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.16929
2023-09-03 23:29:26,772 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 248.63791
2023-09-03 23:29:26,772 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.09746
2023-09-03 23:29:26,773 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.17690
2023-09-03 23:29:26,773 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.31742
2023-09-03 23:29:26,773 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sun Sep  3 23:29:26 2023
file_path: /data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss-fullsample-distmult_notext_distmult_contrastive_loss_New_PharmKG8k-28_CLcmgat_03_09_2023_23_28_38.log







tmux a -t test2  complex tmux test3 bx7
CUDA_VISIBLE_DEVICES=1 python -m torch.distributed.launch --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-fullsample-complex --score_func complex --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 100 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6

2023-09-04 06:48:19,792 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-04 06:48:19,793 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 61
2023-09-04 06:48:19,793 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-04 06:48:19,793 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.20624
2023-09-04 06:48:19,793 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 251.70269
2023-09-04 06:48:19,793 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.13454
2023-09-04 06:48:19,793 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.22177
2023-09-04 06:48:19,793 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.34643
2023-09-04 06:48:19,793 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-04 06:48:27,173 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-04 06:48:27,173 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.20534
2023-09-04 06:48:27,173 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 256.32982
2023-09-04 06:48:27,173 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.13353
2023-09-04 06:48:27,174 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.22027
2023-09-04 06:48:27,174 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.34486
2023-09-04 06:48:27,174 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Mon Sep  4 06:48:27 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss-fullsample-complex_notext_complex_contrastive_lo
ss_New_PharmKG8k-28_CLcmgat_03_09_2023_17_58_31.log




tmux a -t test2  simple tmux test4 bx7
CUDA_VISIBLE_DEVICES=2 python -m torch.distributed.launch --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-fullsample-simple --score_func simple --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 100 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6

2023-09-04 14:01:33,739 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-04 14:01:33,739 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 123
2023-09-04 14:01:33,740 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-04 14:01:33,740 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.20256
2023-09-04 14:01:33,740 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 248.26923
2023-09-04 14:01:33,740 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.12849
2023-09-04 14:01:33,740 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.21988
2023-09-04 14:01:33,740 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.34654
2023-09-04 14:01:33,740 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-04 14:01:41,134 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-04 14:01:41,134 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.19974
2023-09-04 14:01:41,134 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 248.00207
2023-09-04 14:01:41,135 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.12552
2023-09-04 14:01:41,135 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.21736
2023-09-04 14:01:41,135 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.34355
2023-09-04 14:01:41,135 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Mon Sep  4 14:01:41 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-contrastive_loss-fullsample-simple_notext_simple_contrastive_loss
_New_PharmKG8k-28_CLcmgat_03_09_2023_17_58_32.log




温度系数： 这里记得把动态变化给关闭了.之前的跑的FB15k-237有问题，重新跑

节点8
tmux a -t test1  tem 0.1
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t01 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.1 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0

2023-09-06 08:53:45,423 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-06 08:53:45,423 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 408
2023-09-06 08:53:45,423 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-06 08:53:45,423 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.21884
2023-09-06 08:53:45,423 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 196.75114
2023-09-06 08:53:45,423 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.13831
2023-09-06 08:53:45,424 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.23968
2023-09-06 08:53:45,424 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.37696
2023-09-06 08:53:45,424 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-06 08:53:53,294 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-06 08:53:53,294 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.21777
2023-09-06 08:53:53,294 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 196.18319
2023-09-06 08:53:53,294 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.13681
2023-09-06 08:53:53,294 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.23922
2023-09-06 08:53:53,294 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.37601
2023-09-06 08:53:53,294 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Wed Sep  6 08:53:53 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t01_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_04_09_2023_01_50_55.log


tmux a -t test2  tem 0.2
CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t02 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0

2023-09-05 12:51:24,462 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-05 12:51:24,462 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 243
2023-09-05 12:51:24,462 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-05 12:51:24,462 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22147
2023-09-05 12:51:24,462 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 195.44595
2023-09-05 12:51:24,462 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14072
2023-09-05 12:51:24,462 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24291
2023-09-05 12:51:24,462 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.37869
2023-09-05 12:51:24,462 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-05 12:51:29,517 - run_fb15k-237_no_dgi.py - [INFO] - ²âÊÔ:
2023-09-05 12:51:29,517 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22003
2023-09-05 12:51:29,517 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 196.02827
2023-09-05 12:51:29,517 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.13847
2023-09-05 12:51:29,517 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24204
2023-09-05 12:51:29,517 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.37852
2023-09-05 12:51:29,517 - run_fb15k-237_no_dgi.py - [INFO] - ³ÌÐòÖÕÖ¹Ê±¼ä:Tue Sep  5 12:51:29 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t02_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_04_09_2023_01_50_58.log



tmux a -t test3  tem 0.3
CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t03 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.3 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0

2023-09-05 03:37:20,234 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-05 03:37:20,234 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 164
2023-09-05 03:37:20,234 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-05 03:37:20,234 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.21829
2023-09-05 03:37:20,234 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 193.51948
2023-09-05 03:37:20,235 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.13680
2023-09-05 03:37:20,235 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.23989
2023-09-05 03:37:20,235 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.37837
2023-09-05 03:37:20,235 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-05 03:37:27,137 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-05 03:37:27,137 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.21735
2023-09-05 03:37:27,137 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 195.86102
2023-09-05 03:37:27,137 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.13547
2023-09-05 03:37:27,137 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.23991
2023-09-05 03:37:27,137 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.37671
2023-09-05 03:37:27,138 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Tue Sep  5 03:37:27 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t03_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_04_09_2023_01_51_46.log


tmux a -t test4  tem 0.5
CUDA_VISIBLE_DEVICES=3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t05 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.5 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0

2023-09-05 05:34:23,931 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-05 05:34:23,931 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 181
2023-09-05 05:34:23,931 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-05 05:34:23,931 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22058
2023-09-05 05:34:23,931 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 192.30912
2023-09-05 05:34:23,931 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.13815
2023-09-05 05:34:23,931 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24403
2023-09-05 05:34:23,932 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38098
2023-09-05 05:34:23,932 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-05 05:34:29,049 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-05 05:34:29,049 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.21957
2023-09-05 05:34:29,049 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 192.79964
2023-09-05 05:34:29,049 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.13778
2023-09-05 05:34:29,050 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24211
2023-09-05 05:34:29,050 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.37912
2023-09-05 05:34:29,050 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Tue Sep  5 05:34:29 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t05_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_04_09_2023_01_51_46.log



tmux a -t test4  tem 0.7 tmux a -t test4 160
CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0 #目前效果最好


2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 377
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22973
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 188.43178
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14659
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.25325
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.39241
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-07 13:14:37,982 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-07 13:14:37,983 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22848
2023-09-07 13:14:37,983 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 189.18711
2023-09-07 13:14:37,983 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14546
2023-09-07 13:14:37,983 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.25183
2023-09-07 13:14:37,983 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38974
2023-09-07 13:14:37,983 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Thu Sep  7 13:14:37 2023
file_path: /data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_04_09_2023_01_51_41.log

160 在节点7上再测试一下：tmux a -t test4  tem 0.7

CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0

再跑一下，看看是否能再现


执行 /home/bingxing2/home/scx6266/GNN/new_CMGAT2

加载模型： tmux a -t cmgat1 节点8 静态温度系数
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6


tmux a -t cmgat2 节点8 动态温度系数
CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 1 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --conve_act relu6






tmux a -t test2  tem 0.8 节点7
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t08 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.8 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0

2023-09-05 14:09:44,007 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-05 14:09:44,008 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 179
2023-09-05 14:09:44,008 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-05 14:09:44,008 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22315
2023-09-05 14:09:44,008 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 191.25425
2023-09-05 14:09:44,008 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14095
2023-09-05 14:09:44,008 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24579
2023-09-05 14:09:44,008 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38334
2023-09-05 14:09:44,008 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-05 14:09:52,242 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-05 14:09:52,242 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22304
2023-09-05 14:09:52,242 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 193.43529
2023-09-05 14:09:52,242 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14039
2023-09-05 14:09:52,242 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24693
2023-09-05 14:09:52,242 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38314
2023-09-05 14:09:52,242 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Tue Sep  5 14:09:52 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t08_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_04_09_2023_10_08_26.log
(GNN) [scx6266@paraai-n32-h-0


tmux a -t test3  tem 1.0 节点7 
CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t10 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 1.0 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0

2023-09-06 02:10:12,316 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-06 02:10:12,317 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 298
2023-09-06 02:10:12,317 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-06 02:10:12,317 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22535
2023-09-06 02:10:12,317 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 194.84237
2023-09-06 02:10:12,317 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14262
2023-09-06 02:10:12,317 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24908
2023-09-06 02:10:12,317 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38606
2023-09-06 02:10:12,317 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-06 02:10:18,742 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-06 02:10:18,744 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22452
2023-09-06 02:10:18,744 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 193.93363
2023-09-06 02:10:18,744 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14197
2023-09-06 02:10:18,744 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24706
2023-09-06 02:10:18,744 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38582
2023-09-06 02:10:18,744 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Wed Sep  6 02:10:18 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t10_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_04_09_2023_10_08_26.log

再测试一下：

2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 310
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22530
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 193.12016
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14256
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24944
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38633
2023-09-16 05:25:00,876 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22506
2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 192.83015
2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14238
2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24845
2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38581
2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep 16 05:25:08 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t10_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_14_09_2023_09_58_45.log





节点8上：


先试验一下初始温度系数等于1.0的变化策略： 节点8

tmux a -t test2  tem 1.0 节点8
CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t10 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 1.0 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 1


2023-09-06 10:31:09,952 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 136
2023-09-06 10:31:09,952 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-06 10:31:09,952 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22078
2023-09-06 10:31:09,952 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 192.07535
2023-09-06 10:31:09,952 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.13828
2023-09-06 10:31:09,952 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24324
2023-09-06 10:31:09,952 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38209
2023-09-06 10:31:09,952 - run_fb15k-237_no_dgi.py - [INFO] -

LP_ReLU6-conve-fullsample-t10_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_05_09_2023_14_24_21

is inf:tensor([[       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf,        inf,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        ...,
        [1.0000e-08, 1.0000e-08, 1.0000e-08,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08],
        [       inf, 1.0000e-08,        inf,  ..., 1.0000e-08, 1.0000e-08,
         1.0000e-08]], device='cuda:0', grad_fn=<AddBackward0>)


测试：
CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t10 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 1.0 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 1 --save_path LP_ReLU6-conve-fullsample-t10_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_05_09_2023_14_24_21 --test 1

2023-09-06 17:10:32,773 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-06 17:10:32,773 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.21996
2023-09-06 17:10:32,773 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 192.63894
2023-09-06 17:10:32,773 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.13730
2023-09-06 17:10:32,774 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24302
2023-09-06 17:10:32,774 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38097
2023-09-06 17:10:32,774 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Wed Sep  6 17:10:32 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t10_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_06_09_2023_17_09_50.log




再测试 节点7 

tmux a -t test2  tem 1.5 节点7 tem = 1.5
CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t15 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 1.5 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --change_tem 1

2023-09-09 19:32:04,967 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-09 19:32:04,967 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 148
2023-09-09 19:32:04,967 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-09 19:32:04,967 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22168
2023-09-09 19:32:04,967 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 192.09366
2023-09-09 19:32:04,967 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.13819
2023-09-09 19:32:04,967 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24548
2023-09-09 19:32:04,967 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38438
2023-09-09 19:32:04,967 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-09 19:32:11,699 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-09 19:32:11,700 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22133
2023-09-09 19:32:11,700 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 193.34673
2023-09-09 19:32:11,700 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.13784
2023-09-09 19:32:11,700 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24545
2023-09-09 19:32:11,700 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38385
2023-09-09 19:32:11,700 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep  9 19:32:11 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-fullsample-t15_notext_conve_contrastive_loss_New_PharmKG8k-28_CLc
mgat_08_09_2023_20_45_36.log



再试一下1.0 节点7， test3
CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t10 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 1.0 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --change_tem 1

2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 310
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22530
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 193.12016
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14256
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24944
2023-09-16 05:25:00,875 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38633
2023-09-16 05:25:00,876 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22506
2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 192.83015
2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14238
2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24845
2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38581
2023-09-16 05:25:08,148 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep 16 05:25:08 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t10_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_14_09_2023_09_58_45.log




再试一下0.7,节点7，test4
CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --change_tem 1

2023-09-12 22:19:32,947 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-12 22:19:32,947 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 181
2023-09-12 22:19:32,947 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-12 22:19:32,947 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22482
2023-09-12 22:19:32,947 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 191.89658
2023-09-12 22:19:32,947 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14226
2023-09-12 22:19:32,947 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24834
2023-09-12 22:19:32,948 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38475
2023-09-12 22:19:32,948 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-12 22:19:39,432 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-12 22:19:39,433 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22373
2023-09-12 22:19:39,433 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 193.56950
2023-09-12 22:19:39,433 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14114
2023-09-12 22:19:39,433 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24623
2023-09-12 22:19:39,433 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38313
2023-09-12 22:19:39,433 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Tue Sep 12 22:19:39 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLc
mgat_11_09_2023_18_14_18.log


静态温度系数：
2023-09-13 23:57:37,300 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-13 23:57:37,300 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 231
2023-09-13 23:57:37,300 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-13 23:57:37,300 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22335
2023-09-13 23:57:37,300 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 191.55038
2023-09-13 23:57:37,300 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14160
2023-09-13 23:57:37,300 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24584
2023-09-13 23:57:37,300 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38305
2023-09-13 23:57:37,300 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-13 23:57:46,145 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-13 23:57:46,145 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22172
2023-09-13 23:57:46,145 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 193.88685
2023-09-13 23:57:46,146 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.13958
2023-09-13 23:57:46,146 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24363
2023-09-13 23:57:46,146 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38189
2023-09-13 23:57:46,149 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Wed Sep 13 23:57:46 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLc
mgat_12_09_2023_13_38_31.log

无法再现tem = 0.7的时候的巅峰结果
2023-09-18 15:56:18,607 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-18 15:56:18,607 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 310
2023-09-18 15:56:18,607 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-18 15:56:18,607 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22459
2023-09-18 15:56:18,607 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 193.24152
2023-09-18 15:56:18,607 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14285
2023-09-18 15:56:18,607 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24733
2023-09-18 15:56:18,607 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38375
2023-09-18 15:56:18,607 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-18 15:56:27,334 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-18 15:56:27,335 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22316
2023-09-18 15:56:27,335 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 193.96881
2023-09-18 15:56:27,335 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14123
2023-09-18 15:56:27,335 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24607
2023-09-18 15:56:27,335 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38164
2023-09-18 15:56:27,335 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Mon Sep 18 15:56:27 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_16_09_2023_20_21_49.log

试一下更多的epoch，设置 stop_num = 100;tmux a -t test4

2023-09-21 16:32:05,259 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-21 16:32:05,259 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 310
2023-09-21 16:32:05,259 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-21 16:32:05,259 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22359
2023-09-21 16:32:05,259 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 194.40555
2023-09-21 16:32:05,259 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14205
2023-09-21 16:32:05,259 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24572
2023-09-21 16:32:05,259 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38332
2023-09-21 16:32:05,259 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-21 16:32:12,424 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-21 16:32:12,424 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22165
2023-09-21 16:32:12,424 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 194.96609
2023-09-21 16:32:12,424 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.13937
2023-09-21 16:32:12,424 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24464
2023-09-21 16:32:12,425 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38410
2023-09-21 16:32:12,425 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Thu Sep 21 16:32:12 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_19_09_2023_15_32_02.log


加大epoch之后，依旧无法在现，说明，并行上的部分代码有问题




随机性有点大呀？？？



温度系数越大，目前来看效果越好，那试试1.1,1.2,1.3,1.5,1.7,1.9,2.0,更小的温度系数导致溢出


tmux a -t test3  tem 1.1 节点8
CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t11 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 1.1 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0


2023-09-07 09:52:23,582 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-07 09:52:23,582 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 310
2023-09-07 09:52:23,582 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-07 09:52:23,582 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22599
2023-09-07 09:52:23,582 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 193.08370
2023-09-07 09:52:23,585 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14388
2023-09-07 09:52:23,585 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24844
2023-09-07 09:52:23,585 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38783
2023-09-07 09:52:23,585 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-07 09:52:31,129 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-07 09:52:31,129 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22509
2023-09-07 09:52:31,129 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 193.01856
2023-09-07 09:52:31,129 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14317
2023-09-07 09:52:31,129 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24762
2023-09-07 09:52:31,129 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38570
2023-09-07 09:52:31,129 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Thu Sep  7 09:52:31 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t11_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_05_09_2023_14_27_36.log


tmux a -t test4  tem 1.2 节点8
CUDA_VISIBLE_DEVICES=3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t12 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 1.2 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0

2023-09-07 09:21:40,459 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-07 09:21:40,459 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 310
2023-09-07 09:21:40,459 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-07 09:21:40,459 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22629
2023-09-07 09:21:40,459 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 191.23210
2023-09-07 09:21:40,461 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14345
2023-09-07 09:21:40,461 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.25060
2023-09-07 09:21:40,461 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38616
2023-09-07 09:21:40,461 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-07 09:21:45,436 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-07 09:21:45,436 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22655
2023-09-07 09:21:45,436 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 192.50708
2023-09-07 09:21:45,436 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14473
2023-09-07 09:21:45,436 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24963
2023-09-07 09:21:45,436 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38374
2023-09-07 09:21:45,437 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Thu Sep  7 09:21:45 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t12_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_05_09_2023_14_27_45.log



tmux a -t test2  tem 1.3 节点7
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t13 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 1.3 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0

2023-09-07 09:09:01,668 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-07 09:09:01,668 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 310
2023-09-07 09:09:01,668 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-07 09:09:01,668 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22647
2023-09-07 09:09:01,668 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 193.74692
2023-09-07 09:09:01,670 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14358
2023-09-07 09:09:01,670 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.25066
2023-09-07 09:09:01,670 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38730
2023-09-07 09:09:01,670 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-07 09:09:10,387 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-07 09:09:10,387 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22535
2023-09-07 09:09:10,387 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 193.69707
2023-09-07 09:09:10,387 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14229
2023-09-07 09:09:10,387 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24967
2023-09-07 09:09:10,387 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38616
2023-09-07 09:09:10,387 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Thu Sep  7 09:09:10 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t13_notext_conve_contrastive_loss_New_PharmKG8k-28_CL
cmgat_05_09_2023_14_29_57.log


tmux a -t test4  tem 1.5 节点7
CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t15 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 1.5 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0

2023-09-07 12:18:57,438 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-07 12:18:57,438 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 325
2023-09-07 12:18:57,438 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-07 12:18:57,438 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22557
2023-09-07 12:18:57,438 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 193.43667
2023-09-07 12:18:57,438 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14284
2023-09-07 12:18:57,438 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.24834
2023-09-07 12:18:57,438 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.38678
2023-09-07 12:18:57,438 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-07 12:19:04,676 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-07 12:19:04,676 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22483
2023-09-07 12:19:04,676 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 194.82942
2023-09-07 12:19:04,676 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14185
2023-09-07 12:19:04,676 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.24873
2023-09-07 12:19:04,676 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38593
2023-09-07 12:19:04,676 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Thu Sep  7 12:19:04 2023
2023-09-07 12:19:04,681 - run_fb15k-237_no_dgi.py - [INFO] - file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t15_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_05_09_2023_14_29_57.log
2023-09-07 12:19:04,681 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Thu Sep  7 12:19:04 2023

现在有个问题：动态温度系数出现溢出，固定温度系数则没有这问题



目前看温度系数对部分数据集影响还是挺大的 在PharmKG上 tem = 0.7最好


我们试一下DRKG17k-21以及BioKG72k-14


tmux a -t test3  tem 0.7 节点7
CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset DRKG17k-21 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0 --model_dir ./drkg17k-21_model_save  --log_dir ./drkg17k-21_log

2023-09-08 06:32:04,003 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-08 06:32:04,003 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 30
2023-09-08 06:32:04,003 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-08 06:32:04,003 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.57571
2023-09-08 06:32:04,003 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 173.48555
2023-09-08 06:32:04,003 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.48771
2023-09-08 06:32:04,003 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.62398
2023-09-08 06:32:04,003 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.74174
2023-09-08 06:32:04,003 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-08 06:32:14,123 - run_fb15k-237_no_dgi.py - [INFO] - ²âÊÔ:
2023-09-08 06:32:14,123 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.57190
2023-09-08 06:32:14,123 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 176.42746
2023-09-08 06:32:14,123 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.48315
2023-09-08 06:32:14,123 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.62038
2023-09-08 06:32:14,124 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.73947
2023-09-08 06:32:14,124 - run_fb15k-237_no_dgi.py - [INFO] - ³ÌÐòÖÕÖ¹Ê±¼ä:Fri Sep  8 06:32:14 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/drkg17k-21_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_DRKG17k-21_CLcmga
t_07_09_2023_17_09_55.log



tmux a -t test1  tem 0.7 节点7
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset BioKG72k_14 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0 --model_dir ./biokg_model_save  --log_dir ./biokg_log

0.7效果不好

2023-09-10 23:05:00,604 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-10 23:05:00,604 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 45
2023-09-10 23:05:00,604 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-10 23:05:00,604 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22584
2023-09-10 23:05:00,604 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 5116.72097
2023-09-10 23:05:00,604 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.17626
2023-09-10 23:05:00,604 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.23708
2023-09-10 23:05:00,604 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.31840
2023-09-10 23:05:00,604 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-10 23:05:43,193 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-10 23:05:43,194 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22622
2023-09-10 23:05:43,194 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 5120.01116
2023-09-10 23:05:43,194 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.17630
2023-09-10 23:05:43,194 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.23801
2023-09-10 23:05:43,194 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.31928
2023-09-10 23:05:43,194 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sun Sep 10 23:05:43 2023
2023-09-10 23:05:43,198 - run_fb15k-237_no_dgi.py - [INFO] - file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/biokg_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_BioKG72k_14_CLcmgat_07_09_2023_17_12_38.log


再一次 test2, 节点7，变温度系数
CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset BioKG72k_14 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t15 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 1.5 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 1 --model_dir ./biokg_model_save  --log_dir ./biokg_log



跑DRKG完整版数据集 节点8，tmux a -t test2 不行

CUDA_VISIBLE_DEVICES=0 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset DRKG --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-contrastive_loss-fullsample --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 1.0 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./drkg_model_save  --log_dir ./drkg_log --conve_act relu6






tmux a -t test4  tem 0.7 tmux a -t test4 160
CUDA_VISIBLE_DEVICES=3 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0 #目前效果最好

2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - Early Stopping!!
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_epoch: 377
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_lr: 0.0010000000
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_mrr: 0.22973
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_mr: 188.43178
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_hit1: 0.14659
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_hit3: 0.25325
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - best_hit10: 0.39241
2023-09-07 13:14:25,739 - run_fb15k-237_no_dgi.py - [INFO] - 


2023-09-07 13:14:37,982 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-07 13:14:37,983 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22848
2023-09-07 13:14:37,983 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 189.18711
2023-09-07 13:14:37,983 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.14546
2023-09-07 13:14:37,983 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.25183
2023-09-07 13:14:37,983 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.38974
2023-09-07 13:14:37,983 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Thu Sep  7 13:14:37 2023
file_path: /data/fzg/GNN/医学GNN/new_达到实验结果的CMGAT/fb15k237_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_04_09_2023_01_51_41.log



特殊测试集上的测试： --special_test  节点8 test2 文件：Gene_Chemical；Chemical_Disease；Disease_Disease；Gene_Gene；Gene_Disease；Chemical_Chemical

CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --change_tem 0 --save_path LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_04_09_2023_01_51_41 --test 1 --special_test Gene_Chemical
2023-09-09 18:31:10,199 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-09 18:31:10,199 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.16030
2023-09-09 18:31:10,199 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 262.46487
2023-09-09 18:31:10,199 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.09331
2023-09-09 18:31:10,199 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.16930
2023-09-09 18:31:10,199 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.29604
2023-09-09 18:31:10,200 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep  9 18:31:10 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_09_09_2023_18_30_36.log



CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --change_tem 0 --save_path LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_04_09_2023_01_51_41 --test 1 --special_test Chemical_Disease
2023-09-09 18:34:16,099 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-09 18:34:16,099 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.15320
2023-09-09 18:34:16,099 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 119.82946
2023-09-09 18:34:16,099 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.08232
2023-09-09 18:34:16,099 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.15964
2023-09-09 18:34:16,099 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.29112
2023-09-09 18:34:16,100 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep  9 18:34:16 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_09_09_2023_18_33_43.log


CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --change_tem 0 --save_path LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_04_09_2023_01_51_41 --test 1 --special_test Disease_Disease
2023-09-09 18:35:51,654 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-09 18:35:51,654 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.47137
2023-09-09 18:35:51,654 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 122.45522
2023-09-09 18:35:51,654 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.37687
2023-09-09 18:35:51,654 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.50746
2023-09-09 18:35:51,654 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.65299
2023-09-09 18:35:51,655 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep  9 18:35:51 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_09_09_2023_18_35_21.log


CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --change_tem 0 --save_path LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_04_09_2023_01_51_41 --test 1 --special_test Gene_Gene
2023-09-09 18:37:19,454 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-09 18:37:19,454 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.24439
2023-09-09 18:37:19,454 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 195.00847
2023-09-09 18:37:19,454 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.15603
2023-09-09 18:37:19,454 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.27497
2023-09-09 18:37:19,454 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.41279
2023-09-09 18:37:19,454 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep  9 18:37:19 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_09_09_2023_18_36_41.log




CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --change_tem 0 --save_path LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_04_09_2023_01_51_41 --test 1 --special_test Gene_Disease
2023-09-09 18:39:00,153 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-09 18:39:00,153 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.17541
2023-09-09 18:39:00,153 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 243.70628
2023-09-09 18:39:00,153 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.10319
2023-09-09 18:39:00,153 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.18644
2023-09-09 18:39:00,153 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.32030
2023-09-09 18:39:00,154 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep  9 18:39:00 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_09_09_2023_18_38_28.log



CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log --change_tem 0 --save_path LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_04_09_2023_01_51_41 --test 1 --special_test Chemical_Chemical

2023-09-09 18:40:22,881 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-09 18:40:22,881 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.48290
2023-09-09 18:40:22,881 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 28.15204
2023-09-09 18:40:22,881 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.36684
2023-09-09 18:40:22,881 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.53700
2023-09-09 18:40:22,881 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.71324
2023-09-09 18:40:22,881 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep  9 18:40:22 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/pharm8k_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_New_PharmKG8k-28_CLcmgat_09_09_2023_18_39_48.log



DRKG17k-21

特殊测试集上的测试： --special_test  节点8 test2 文件：Compound_Atc;Compound_Compound;Compound_Gene;Disease_Gene;Gene_Gene

CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset DRKG17k-21 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./drkg17k-21_model_save  --log_dir ./drkg17k-21_log --change_tem 0 --save_path LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_DRKG17k-21_CLcmgat_07_09_2023_17_09_55 --test 1 --special_test Compound_Atc
2023-09-09 20:37:54,109 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-09 20:37:54,109 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.00046
2023-09-09 20:37:54,109 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 11218.27966
2023-09-09 20:37:54,109 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.00000
2023-09-09 20:37:54,110 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.00000
2023-09-09 20:37:54,110 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.00000
2023-09-09 20:37:54,110 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep  9 20:37:54 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/drkg17k-21_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_DRKG17k-21_CLcmgat_09_09_2023_20_37_14.log
怎么是0呀？

换个模型试试：LP_ChangeLR-UnitVec-BN-CLoss-part-sample-Tem1.0_notext_conve_contrastive_loss_DRKG17k-21_CLcmgat_07_07_2023_11_15_32


CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset DRKG17k-21 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./drkg17k-21_model_save  --log_dir ./drkg17k-21_log --change_tem 0 --save_path LP_ReLU6-conve-tem02-fullsample_notext_conve_contrastive_loss_DRKG17k-21_CLcmgat_14_08_2023_15_34_38 --test 1 --special_test Compound_Atc




CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset DRKG17k-21 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./drkg17k-21_model_save  --log_dir ./drkg17k-21_log --change_tem 0 --save_path LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_DRKG17k-21_CLcmgat_07_09_2023_17_09_55 --test 1 --special_test Compound_Compound
2023-09-09 20:42:20,760 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-09 20:42:20,760 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.63971
2023-09-09 20:42:20,760 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 24.97282
2023-09-09 20:42:20,760 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.54866
2023-09-09 20:42:20,760 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.69288
2023-09-09 20:42:20,760 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.81111
2023-09-09 20:42:20,760 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep  9 20:42:20 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/drkg17k-21_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_DRKG17k-21_CLcmgat_09_09_2023_20_41_31.log


CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset DRKG17k-21 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./drkg17k-21_model_save  --log_dir ./drkg17k-21_log --change_tem 0 --save_path LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_DRKG17k-21_CLcmgat_07_09_2023_17_09_55 --test 1 --special_test Compound_Gene
2023-09-09 20:52:33,302 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-09 20:52:33,302 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.33336
2023-09-09 20:52:33,302 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 1409.02598
2023-09-09 20:52:33,302 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.25812
2023-09-09 20:52:33,302 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.36264
2023-09-09 20:52:33,302 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.48019
2023-09-09 20:52:33,302 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep  9 20:52:33 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/drkg17k-21_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_DRKG17k-21_CLcmgat_09_09_2023_20_51_51.log



CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset DRKG17k-21 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./drkg17k-21_model_save  --log_dir ./drkg17k-21_log --change_tem 0 --save_path LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_DRKG17k-21_CLcmgat_07_09_2023_17_09_55 --test 1 --special_test Disease_Gene
2023-09-09 20:54:22,356 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-09 20:54:22,356 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.22219
2023-09-09 20:54:22,356 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 6557.72340
2023-09-09 20:54:22,357 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.13830
2023-09-09 20:54:22,357 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.22340
2023-09-09 20:54:22,357 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.44681
2023-09-09 20:54:22,357 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep  9 20:54:22 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/drkg17k-21_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_DRKG17k-21_CLcmgat_09_09_2023_20_53_40.log


CUDA_VISIBLE_DEVICES=1 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset DRKG17k-21 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --model_dir ./drkg17k-21_model_save  --log_dir ./drkg17k-21_log --change_tem 0 --save_path LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_DRKG17k-21_CLcmgat_07_09_2023_17_09_55 --test 1 --special_test Gene_Gene
2023-09-09 20:57:40,024 - run_fb15k-237_no_dgi.py - [INFO] - 测试:
2023-09-09 20:57:40,025 - run_fb15k-237_no_dgi.py - [INFO] - Test_mrr: 0.24339
2023-09-09 20:57:40,025 - run_fb15k-237_no_dgi.py - [INFO] - Test_mr: 157.08997
2023-09-09 20:57:40,025 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit1: 0.16045
2023-09-09 20:57:40,025 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit3: 0.27178
2023-09-09 20:57:40,025 - run_fb15k-237_no_dgi.py - [INFO] - Test_hit10: 0.39958
2023-09-09 20:57:40,025 - run_fb15k-237_no_dgi.py - [INFO] - 程序终止时间:Sat Sep  9 20:57:40 2023
file_path: /home/bingxing2/home/scx6266/GNN/new_CMGAT/drkg17k-21_log/LP_ReLU6-conve-fullsample-t07_notext_conve_contrastive_loss_DRKG17k-21_CLcmgat_09_09_2023_20_56_58.log






tmux a -t test4  tem 0.7 tmux a -t cmagt2 使用160上的代码试一下0.7
CUDA_VISIBLE_DEVICES=2 torchrun --rdzv_backend c10d --rdzv_endpoint localhost:0 --nnodes 1 --nproc_per_node 1 --rdzv_id 1 run_fb15k-237_no_dgi.py  --dataset New_PharmKG8k-28 --loss_function contrastive_loss --use_test 1 --test_name  ReLU6-conve-fullsample-t07 --score_func conve --subgraph_loss_rate 0.0 --sample_mod full --temperature 0.7 --stop_num 50 --change_lr 0 --optimizer adam  --Q 1.0 --neg_sample_num 1000 --change_tem 0  --model_dir ./pharm8k_model_save  --log_dir ./pharm8k_log